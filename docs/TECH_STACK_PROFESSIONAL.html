<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocSera - Technology Stack Documentation</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #009092;
            --primary-dark: #007577;
            --primary-light: #e6f5f5;
            --text: #1a1a2e;
            --text-light: #64748b;
            --bg: #ffffff;
            --border: #e2e8f0;
            --success: #10b981;
            --warning: #f59e0b;
            --code-bg: #f1f5f9;
            --diagram-bg: #f8fafc;
            --diagram-text: #1a1a2e;
            --diagram-border: #e2e8f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, sans-serif;
            color: var(--text);
            line-height: 1.6;
            background: var(--bg);
            font-size: 10pt;
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }

        @page {
            size: A4;
            margin: 15mm 12mm;
        }

        @media print {
            body {
                font-size: 9pt;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            .page-break {
                page-break-before: always;
            }

            .no-break {
                page-break-inside: avoid;
            }

            table {
                page-break-inside: avoid;
            }

            /* Keep headings with their content */
            h2,
            h3,
            h4 {
                page-break-after: avoid;
                break-after: avoid;
            }

            /* Prevent orphaned headings */
            h2+p,
            h2+div,
            h2+table,
            h3+p,
            h3+div,
            h3+ul,
            h3+table,
            h4+p,
            h4+ul {
                page-break-before: avoid;
                break-before: avoid;
            }

            /* Keep diagram containers together */
            .diagram-container {
                page-break-inside: avoid;
                break-inside: avoid;
                background: var(--diagram-bg) !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            /* Keep info boxes together */
            .info-box {
                page-break-inside: avoid;
                break-inside: avoid;
            }

            /* Keep tech stacks together */
            .stack-section {
                page-break-inside: avoid;
                break-inside: avoid;
            }

            /* Keep feature sections together */
            .feature-section {
                page-break-inside: avoid;
                break-inside: avoid;
            }

            /* Keep two-column layouts together */
            .two-col {
                page-break-inside: avoid;
                break-inside: avoid;
            }

            /* Orphan and widow control */
            p,
            li,
            td {
                orphans: 3;
                widows: 3;
            }
        }

        .container {
            max-width: 780px;
            margin: 0 auto;
            padding: 30px 25px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 35px 30px;
            border-radius: 16px;
            text-align: center;
            margin-bottom: 30px;
        }

        .header-logo {
            width: 70px;
            height: 70px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            font-size: 28px;
            font-weight: 700;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .header .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }

        .header-meta {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 18px;
            flex-wrap: wrap;
        }

        .badge {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 600;
        }

        /* Sections */
        h2 {
            font-size: 16px;
            font-weight: 700;
            color: var(--primary-dark);
            margin: 28px 0 14px;
            padding: 10px 0 8px;
            border-bottom: 2px solid var(--primary);
        }

        h3 {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            margin: 18px 0 10px;
            padding-left: 10px;
            border-left: 3px solid var(--primary);
        }

        p {
            margin-bottom: 12px;
            font-size: 10pt;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 12px 0 20px;
            font-size: 9pt;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        th {
            background: var(--primary);
            color: white;
            padding: 10px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        th:first-child {
            border-top-left-radius: 8px;
        }

        th:last-child {
            border-top-right-radius: 8px;
        }

        tr:last-child td:first-child {
            border-bottom-left-radius: 8px;
        }

        tr:last-child td:last-child {
            border-bottom-right-radius: 8px;
        }

        td {
            padding: 8px 12px;
            border-bottom: 1px solid var(--border);
            vertical-align: top;
        }

        tr:nth-child(even) {
            background: var(--code-bg);
        }

        code {
            background: var(--code-bg);
            padding: 1px 5px;
            border-radius: 3px;
            font-family: 'SF Mono', Monaco, Consolas, monospace;
            font-size: 9pt;
            color: var(--primary-dark);
        }

        .status-enabled {
            color: var(--success);
            font-weight: 600;
        }

        .status-pending {
            color: var(--warning);
            font-weight: 600;
        }

        /* Info boxes */
        .info-box {
            background: var(--primary-light);
            border-left: 4px solid var(--primary);
            padding: 12px 16px;
            border-radius: 0 8px 8px 0;
            margin: 16px 0;
            font-size: 9pt;
        }

        .info-box strong {
            color: var(--primary-dark);
        }

        .warning-box {
            background: #fef3c7;
            border-left: 4px solid var(--warning);
            padding: 12px 16px;
            border-radius: 0 8px 8px 0;
            margin: 16px 0;
            font-size: 9pt;
        }

        /* Diagram Container - Dark theme like reference */
        .diagram-container {
            background: var(--diagram-bg);
            border-radius: 12px;
            padding: 25px;
            margin: 16px 0;
            overflow: hidden;
        }

        .diagram-title {
            color: var(--diagram-text);
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        /* SVG Diagrams */
        .diagram-container svg {
            width: 100%;
            height: auto;
        }

        /* Feature Grid */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 16px 0;
        }

        .feature-card {
            background: var(--code-bg);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid var(--border);
        }

        .feature-card h4 {
            font-size: 10px;
            color: var(--primary-dark);
            margin-bottom: 4px;
        }

        .feature-card p {
            font-size: 8px;
            color: var(--text-light);
            margin: 0;
            line-height: 1.4;
        }

        /* TOC */
        .toc {
            background: var(--code-bg);
            border-radius: 10px;
            padding: 18px 22px;
            margin: 20px 0;
            column-count: 2;
            column-gap: 25px;
        }

        .toc-title {
            font-weight: 600;
            font-size: 11px;
            margin-bottom: 12px;
            color: var(--primary-dark);
            column-span: all;
        }

        .toc-item {
            padding: 4px 0;
            font-size: 9px;
            border-bottom: 1px dotted var(--border);
            break-inside: avoid;
        }

        /* Footer */
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid var(--border);
            text-align: center;
            color: var(--text-light);
            font-size: 9px;
        }
    </style>
</head>

<body>
    <div class="container">

        <!-- Header -->
        <div class="header no-break">
            <img src="docsera_logo.svg" alt="DocSera" style="height: 20px; margin-bottom: 8px;">
            <div class="subtitle">Technology Stack Documentation</div>
            <div class="header-meta">
                <span class="badge">Version 1.0.0+14</span>
                <span class="badge">Flutter 3.6+</span>
                <span class="badge">Supabase</span>
                <span class="badge">PostgreSQL 15</span>
                <span class="badge">iOS & Android</span>
            </div>
        </div>

        <!-- TOC -->
        <div class="toc no-break">
            <div class="toc-title">üìã Table of Contents</div>
            <div class="toc-item">1. Architecture Overview</div>
            <div class="toc-item">2. Frontend Stack</div>
            <div class="toc-item">3. Backend Infrastructure</div>
            <div class="toc-item">4. State Management</div>
            <div class="toc-item">5. Database Schema</div>
            <div class="toc-item">6. Entity Relationships</div>
            <div class="toc-item">7. Database Views</div>
            <div class="toc-item">8. RPC Functions</div>
            <div class="toc-item">9. Edge Functions</div>
            <div class="toc-item">10. Database Triggers</div>
            <div class="toc-item">11. Security Features</div>
            <div class="toc-item">12. Package Dependencies</div>
            <div class="toc-item">13. Network Resilience</div>
            <div class="toc-item">14. Localization</div>
            <div class="toc-item">15. Platform Support</div>
        </div>

        <!-- 1. Architecture Overview -->
        <h2>1. Architecture Overview</h2>

        <div class="diagram-container no-break">
            <svg viewBox="0 0 700 320" xmlns="http://www.w3.org/2000/svg">
                <!-- Styles -->
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#009092" />
                    </marker>
                </defs>

                <!-- Client Applications Group -->
                <rect x="150" y="20" width="400" height="60" rx="4" fill="none" stroke="#ccc" stroke-dasharray="5,3" />
                <text x="350" y="35" text-anchor="middle" fill="#666" font-size="10" font-family="Montserrat">Client
                    Applications</text>
                <rect x="170" y="45" width="140" height="28" rx="4" fill="#fff" stroke="#009092" />
                <text x="240" y="64" text-anchor="middle" fill="#007577" font-size="10" font-family="Montserrat">DocSera
                    Pro (Doctor App)</text>
                <rect x="390" y="45" width="140" height="28" rx="4" fill="#fff" stroke="#009092" />
                <text x="460" y="64" text-anchor="middle" fill="#007577" font-size="10" font-family="Montserrat">DocSera
                    (Patient App)</text>

                <!-- Arrow down -->
                <line x1="350" y1="85" x2="350" y2="105" stroke="#009092" stroke-width="2"
                    marker-end="url(#arrowhead)" />

                <!-- Supabase Backend Group -->
                <rect x="80" y="110" width="540" height="80" rx="4" fill="none" stroke="#ccc" stroke-dasharray="5,3" />
                <text x="350" y="125" text-anchor="middle" fill="#666" font-size="10" font-family="Montserrat">Supabase
                    Backend</text>
                <rect x="95" y="140" width="90" height="40" rx="4" fill="#fff" stroke="#009092" />
                <text x="140" y="165" text-anchor="middle" fill="#007577" font-size="9"
                    font-family="Montserrat">Authentication</text>
                <rect x="195" y="140" width="90" height="40" rx="4" fill="#fff" stroke="#009092" />
                <text x="240" y="165" text-anchor="middle" fill="#007577" font-size="9"
                    font-family="Montserrat">PostgreSQL
                    v15</text>
                <rect x="295" y="140" width="90" height="40" rx="4" fill="#fff" stroke="#009092" />
                <text x="340" y="165" text-anchor="middle" fill="#007577" font-size="9" font-family="Montserrat">File
                    Storage</text>
                <rect x="395" y="140" width="100" height="40" rx="4" fill="#fff" stroke="#009092" />
                <text x="445" y="165" text-anchor="middle" fill="#007577" font-size="9"
                    font-family="Montserrat">Realtime
                    Subs</text>
                <rect x="505" y="140" width="100" height="40" rx="4" fill="#fff" stroke="#009092" />
                <text x="555" y="165" text-anchor="middle" fill="#007577" font-size="9" font-family="Montserrat">Edge
                    Functions</text>

                <!-- Arrow down -->
                <line x1="350" y1="195" x2="350" y2="215" stroke="#009092" stroke-width="2"
                    marker-end="url(#arrowhead)" />

                <!-- External Services Group -->
                <rect x="150" y="220" width="400" height="70" rx="4" fill="none" stroke="#ccc" stroke-dasharray="5,3" />
                <text x="350" y="235" text-anchor="middle" fill="#666" font-size="10" font-family="Montserrat">External
                    Services</text>
                <rect x="200" y="250" width="130" height="30" rx="4" fill="#fff" stroke="#009092" />
                <text x="265" y="270" text-anchor="middle" fill="#007577" font-size="9" font-family="Montserrat">Pushy
                    Push
                    Notifications</text>
                <rect x="370" y="250" width="130" height="30" rx="4" fill="#fff" stroke="#009092" />
                <text x="435" y="270" text-anchor="middle" fill="#007577" font-size="9" font-family="Montserrat">Google
                    Maps / OSM</text>
            </svg>
        </div>

        <div class="info-box">
            <strong>NOTE:</strong> This documentation focuses on <strong>DocSera (Patient App)</strong>. The Supabase
            backend is shared with DocSera Pro (Doctor App).
        </div>

        <!-- Authentication Flow Diagram -->
        <h3>Authentication & Authorization Flow</h3>
        <div class="diagram-container no-break">
            <svg viewBox="0 0 750 440" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <marker id="arrow2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#009092" />
                    </marker>
                    <linearGradient id="authGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#009092;stop-opacity:0.1" />
                        <stop offset="100%" style="stop-color:#007577;stop-opacity:0.1" />
                    </linearGradient>
                </defs>

                <!-- Title -->
                <text x="375" y="20" text-anchor="middle" fill="#333" font-size="12" font-weight="600"
                    font-family="Montserrat">Authentication Flow</text>

                <!-- Entry Point -->
                <ellipse cx="375" cy="55" rx="50" ry="18" fill="#009092" />
                <text x="375" y="60" text-anchor="middle" fill="#fff" font-size="9" font-family="Montserrat">User Opens
                    App</text>

                <!-- Branch Arrow -->
                <line x1="375" y1="73" x2="375" y2="90" stroke="#009092" stroke-width="2" />

                <!-- Decision: Has Credentials? -->
                <polygon points="375,95 445,130 375,165 305,130" fill="url(#authGrad)" stroke="#009092"
                    stroke-width="1.5" />
                <text x="375" y="127" text-anchor="middle" fill="#007577" font-size="8"
                    font-family="Montserrat">Biometric</text>
                <text x="375" y="138" text-anchor="middle" fill="#007577" font-size="8"
                    font-family="Montserrat">Enabled?</text>

                <!-- YES path (Biometric) -->
                <line x1="305" y1="130" x2="180" y2="130" stroke="#009092" stroke-width="1.5" />
                <line x1="180" y1="130" x2="180" y2="175" stroke="#009092" stroke-width="1.5"
                    marker-end="url(#arrow2)" />
                <text x="245" y="123" text-anchor="middle" fill="#4CAF50" font-size="8" font-family="Montserrat"
                    font-weight="600">YES</text>

                <!-- Biometric Auth Box -->
                <rect x="110" y="180" width="140" height="40" rx="4" fill="#fff" stroke="#4CAF50" stroke-width="1.5" />
                <text x="180" y="195" text-anchor="middle" fill="#2E7D32" font-size="8" font-family="Montserrat">üîê Face
                    ID /</text>
                <text x="180" y="208" text-anchor="middle" fill="#2E7D32" font-size="8"
                    font-family="Montserrat">Fingerprint</text>

                <!-- NO path (Manual Login) -->
                <line x1="445" y1="130" x2="570" y2="130" stroke="#009092" stroke-width="1.5" />
                <line x1="570" y1="130" x2="570" y2="175" stroke="#009092" stroke-width="1.5"
                    marker-end="url(#arrow2)" />
                <text x="505" y="123" text-anchor="middle" fill="#666" font-size="8" font-family="Montserrat">NO</text>

                <!-- Manual Login Box -->
                <rect x="500" y="180" width="140" height="40" rx="4" fill="#fff" stroke="#009092" stroke-width="1.5" />
                <text x="570" y="195" text-anchor="middle" fill="#007577" font-size="8" font-family="Montserrat">üìß
                    Email/Phone</text>
                <text x="570" y="208" text-anchor="middle" fill="#007577" font-size="8" font-family="Montserrat">+
                    Password</text>

                <!-- Both paths merge to Supabase Auth -->
                <line x1="180" y1="220" x2="180" y2="255" stroke="#009092" stroke-width="1.5" />
                <line x1="180" y1="255" x2="375" y2="255" stroke="#009092" stroke-width="1.5" />
                <line x1="570" y1="220" x2="570" y2="255" stroke="#009092" stroke-width="1.5" />
                <line x1="570" y1="255" x2="375" y2="255" stroke="#009092" stroke-width="1.5" />
                <line x1="375" y1="255" x2="375" y2="275" stroke="#009092" stroke-width="2" marker-end="url(#arrow2)" />

                <!-- Supabase Auth Box -->
                <rect x="290" y="280" width="170" height="35" rx="4" fill="#009092" />
                <text x="375" y="298" text-anchor="middle" fill="#fff" font-size="9" font-family="Montserrat">Supabase
                    signInWithPassword</text>
                <text x="375" y="309" text-anchor="middle" fill="#fff" font-size="7" font-family="Montserrat">(JWT Token
                    Generated)</text>

                <!-- Arrow down to decision -->
                <line x1="375" y1="315" x2="375" y2="335" stroke="#009092" stroke-width="2" />

                <!-- Decision: Trusted Device? -->
                <polygon points="375,340 445,365 375,390 305,365" fill="url(#authGrad)" stroke="#FF9800"
                    stroke-width="1.5" />
                <text x="375" y="362" text-anchor="middle" fill="#E65100" font-size="8"
                    font-family="Montserrat">Trusted</text>
                <text x="375" y="373" text-anchor="middle" fill="#E65100" font-size="8"
                    font-family="Montserrat">Device?</text>

                <!-- NO - New Device path -->
                <line x1="445" y1="365" x2="520" y2="365" stroke="#FF9800" stroke-width="1.5"
                    marker-end="url(#arrow2)" />
                <text x="480" y="358" text-anchor="middle" fill="#E65100" font-size="7"
                    font-family="Montserrat">NEW</text>

                <!-- Email OTP Box -->
                <rect x="525" y="345" width="100" height="40" rx="4" fill="#FFF3E0" stroke="#FF9800"
                    stroke-width="1.5" />
                <text x="575" y="362" text-anchor="middle" fill="#E65100" font-size="8" font-family="Montserrat">üìß
                    Email OTP</text>
                <text x="575" y="375" text-anchor="middle" fill="#E65100" font-size="7"
                    font-family="Montserrat">Verification</text>

                <!-- OTP Success to App -->
                <line x1="625" y1="365" x2="680" y2="365" stroke="#4CAF50" stroke-width="1.5" />
                <line x1="680" y1="365" x2="680" y2="410" stroke="#4CAF50" stroke-width="1.5" />
                <line x1="680" y1="410" x2="425" y2="410" stroke="#4CAF50" stroke-width="1.5"
                    marker-end="url(#arrow2)" />

                <!-- YES - Trusted Device path -->
                <line x1="305" y1="365" x2="230" y2="365" stroke="#4CAF50" stroke-width="1.5" />
                <line x1="230" y1="365" x2="230" y2="410" stroke="#4CAF50" stroke-width="1.5" />
                <line x1="230" y1="410" x2="325" y2="410" stroke="#4CAF50" stroke-width="1.5"
                    marker-end="url(#arrow2)" />
                <text x="270" y="358" text-anchor="middle" fill="#4CAF50" font-size="7"
                    font-family="Montserrat">TRUSTED</text>

                <!-- App Entry (Success) -->
                <rect x="330" y="395" width="90" height="30" rx="15" fill="#4CAF50" />
                <text x="375" y="415" text-anchor="middle" fill="#fff" font-size="9" font-family="Montserrat">‚úì Enter
                    App</text>

                <!-- Legend -->
                <rect x="20" y="50" width="85" height="70" rx="4" fill="#f9f9f9" stroke="#ddd" />
                <text x="62" y="65" text-anchor="middle" fill="#666" font-size="7" font-weight="600"
                    font-family="Montserrat">Legend</text>
                <rect x="28" y="75" width="10" height="10" rx="2" fill="#4CAF50" />
                <text x="45" y="83" fill="#666" font-size="6" font-family="Montserrat">Biometric</text>
                <rect x="28" y="90" width="10" height="10" rx="2" fill="#009092" />
                <text x="45" y="98" fill="#666" font-size="6" font-family="Montserrat">Auth Flow</text>
                <rect x="28" y="105" width="10" height="10" rx="2" fill="#FF9800" />
                <text x="45" y="113" fill="#666" font-size="6" font-family="Montserrat">OTP Check</text>
            </svg>
        </div>

        <!-- Client-Backend Interaction Diagram -->
        <h3>Client‚ÄìBackend Interaction</h3>
        <div class="diagram-container no-break">
            <svg viewBox="0 0 750 300" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <marker id="arrow3" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#009092" />
                    </marker>
                </defs>

                <!-- Title -->
                <text x="375" y="20" text-anchor="middle" fill="#333" font-size="12" font-weight="600"
                    font-family="Montserrat">Request Flow Architecture</text>

                <!-- Layer Labels (Left Side) -->
                <text x="30" y="70" fill="#666" font-size="8" font-family="Montserrat" font-weight="600">CLIENT</text>
                <text x="30" y="175" fill="#666" font-size="8" font-family="Montserrat" font-weight="600">BACKEND</text>

                <!-- UI Layer -->
                <rect x="80" y="45" width="120" height="45" rx="4" fill="#E3F2FD" stroke="#2196F3" stroke-width="1.5" />
                <text x="140" y="65" text-anchor="middle" fill="#1565C0" font-size="9" font-family="Montserrat"
                    font-weight="600">üì± UI Layer</text>
                <text x="140" y="80" text-anchor="middle" fill="#1565C0" font-size="7" font-family="Montserrat">Screens
                    / Widgets</text>

                <!-- Arrow UI to Cubit -->
                <line x1="200" y1="67" x2="240" y2="67" stroke="#009092" stroke-width="2" marker-end="url(#arrow3)" />

                <!-- Cubit Layer -->
                <rect x="245" y="45" width="120" height="45" rx="4" fill="#E8F5E9" stroke="#4CAF50"
                    stroke-width="1.5" />
                <text x="305" y="65" text-anchor="middle" fill="#2E7D32" font-size="9" font-family="Montserrat"
                    font-weight="600">üß† BLoC/Cubit</text>
                <text x="305" y="80" text-anchor="middle" fill="#2E7D32" font-size="7" font-family="Montserrat">State
                    Management</text>

                <!-- Arrow Cubit to Service -->
                <line x1="365" y1="67" x2="405" y2="67" stroke="#009092" stroke-width="2" marker-end="url(#arrow3)" />

                <!-- Service Layer -->
                <rect x="410" y="45" width="130" height="45" rx="4" fill="#FFF3E0" stroke="#FF9800"
                    stroke-width="1.5" />
                <text x="475" y="65" text-anchor="middle" fill="#E65100" font-size="9" font-family="Montserrat"
                    font-weight="600">‚öôÔ∏è Service Layer</text>
                <text x="475" y="80" text-anchor="middle" fill="#E65100" font-size="7" font-family="Montserrat">Business
                    Logic</text>

                <!-- Local Storage (Side) -->
                <rect x="560" y="45" width="80" height="45" rx="4" fill="#F3E5F5" stroke="#9C27B0" stroke-width="1.5" />
                <text x="600" y="63" text-anchor="middle" fill="#6A1B9A" font-size="8" font-family="Montserrat"
                    font-weight="600">üíæ Local</text>
                <text x="600" y="78" text-anchor="middle" fill="#6A1B9A" font-size="7"
                    font-family="Montserrat">SharedPrefs</text>
                <line x1="540" y1="67" x2="555" y2="67" stroke="#9C27B0" stroke-width="1" stroke-dasharray="3,2" />

                <!-- Divider Line -->
                <line x1="60" y1="110" x2="690" y2="110" stroke="#ddd" stroke-width="1" stroke-dasharray="5,5" />

                <!-- Service to Backend Arrows -->
                <line x1="475" y1="90" x2="475" y2="130" stroke="#009092" stroke-width="2" />

                <!-- Three Backend Paths -->
                <line x1="475" y1="130" x2="200" y2="130" stroke="#009092" stroke-width="1.5" />
                <line x1="200" y1="130" x2="200" y2="155" stroke="#009092" stroke-width="1.5"
                    marker-end="url(#arrow3)" />

                <line x1="475" y1="130" x2="475" y2="155" stroke="#009092" stroke-width="1.5"
                    marker-end="url(#arrow3)" />

                <line x1="475" y1="130" x2="605" y2="130" stroke="#009092" stroke-width="1.5" />
                <line x1="605" y1="130" x2="605" y2="155" stroke="#009092" stroke-width="1.5"
                    marker-end="url(#arrow3)" />

                <!-- RPC Functions Box -->
                <rect x="130" y="160" width="140" height="50" rx="4" fill="#009092" />
                <text x="200" y="180" text-anchor="middle" fill="#fff" font-size="9" font-family="Montserrat"
                    font-weight="600">üîß RPC Functions</text>
                <text x="200" y="195" text-anchor="middle" fill="#fff" font-size="7" font-family="Montserrat">Security
                    Definer</text>

                <!-- Direct DB Box -->
                <rect x="390" y="160" width="140" height="50" rx="4" fill="#009092" />
                <text x="460" y="180" text-anchor="middle" fill="#fff" font-size="9" font-family="Montserrat"
                    font-weight="600">üìä Direct Query</text>
                <text x="460" y="195" text-anchor="middle" fill="#fff" font-size="7" font-family="Montserrat">RLS
                    Protected</text>

                <!-- Edge Functions Box -->
                <rect x="535" y="160" width="140" height="50" rx="4" fill="#007577" />
                <text x="605" y="180" text-anchor="middle" fill="#fff" font-size="9" font-family="Montserrat"
                    font-weight="600">‚ö° Edge Functions</text>
                <text x="605" y="195" text-anchor="middle" fill="#fff" font-size="7"
                    font-family="Montserrat">Deno/TypeScript</text>

                <!-- All paths to PostgreSQL -->
                <!-- From RPC Functions -->
                <line x1="200" y1="210" x2="200" y2="240" stroke="#009092" stroke-width="1.5" />
                <line x1="200" y1="240" x2="375" y2="240" stroke="#009092" stroke-width="1.5" />

                <!-- From Direct Query -->
                <line x1="460" y1="210" x2="460" y2="240" stroke="#009092" stroke-width="1.5" />
                <line x1="460" y1="240" x2="375" y2="240" stroke="#009092" stroke-width="1.5" />

                <!-- From Edge Functions -->
                <line x1="605" y1="210" x2="605" y2="240" stroke="#009092" stroke-width="1.5" />
                <line x1="605" y1="240" x2="375" y2="240" stroke="#009092" stroke-width="1.5" />

                <!-- Final arrow down to PostgreSQL -->
                <line x1="375" y1="240" x2="375" y2="250" stroke="#009092" stroke-width="2" marker-end="url(#arrow3)" />

                <!-- PostgreSQL Box -->
                <rect x="290" y="255" width="170" height="35" rx="4" fill="#336791" />
                <text x="375" y="273" text-anchor="middle" fill="#fff" font-size="10" font-family="Montserrat"
                    font-weight="600">üêò PostgreSQL 15</text>
                <text x="375" y="285" text-anchor="middle" fill="#fff" font-size="7" font-family="Montserrat">+ RLS +
                    Triggers</text>

                <!-- Use Case Labels -->
                <text x="200" y="225" text-anchor="middle" fill="#666" font-size="6" font-family="Montserrat">e.g.
                    Bookings,
                    User Data</text>
                <text x="460" y="225" text-anchor="middle" fill="#666" font-size="6" font-family="Montserrat">e.g.
                    Messages,
                    Doctors</text>
                <text x="605" y="225" text-anchor="middle" fill="#666" font-size="6" font-family="Montserrat">e.g. Email
                    OTP,
                    Push</text>
            </svg>
        </div>

        <!-- Data Ownership Diagram -->
        <h3>Data Ownership & Access Control</h3>
        <div class="diagram-container no-break">
            <svg viewBox="0 0 750 320" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <marker id="arrow4" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#009092" />
                    </marker>
                    <marker id="arrow4g" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#4CAF50" />
                    </marker>
                    <marker id="arrow4o" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#FF9800" />
                    </marker>
                </defs>

                <!-- Title -->
                <text x="375" y="20" text-anchor="middle" fill="#333" font-size="12" font-weight="600"
                    font-family="Montserrat">Medical Data Ownership Model</text>
                <text x="375" y="35" text-anchor="middle" fill="#666" font-size="8" font-family="Montserrat">(Enforced
                    by Row Level Security)</text>

                <!-- Patient (Center/Owner) -->
                <circle cx="375" cy="100" r="45" fill="#E3F2FD" stroke="#2196F3" stroke-width="2" />
                <text x="375" y="105" text-anchor="middle" fill="#1565C0" font-size="9" font-weight="600"
                    font-family="Montserrat">PATIENT</text>
                <text x="375" y="118" text-anchor="middle" fill="#1565C0" font-size="7" font-family="Montserrat">(Data
                    Owner)</text>

                <!-- Doctor (Left) -->
                <circle cx="150" cy="180" r="40" fill="#E8F5E9" stroke="#4CAF50" stroke-width="2" />
                <text x="150" y="185" text-anchor="middle" fill="#2E7D32" font-size="9" font-weight="600"
                    font-family="Montserrat">DOCTOR</text>

                <!-- Relative (Right) -->
                <circle cx="600" cy="180" r="40" fill="#FFF3E0" stroke="#FF9800" stroke-width="2" />
                <text x="600" y="185" text-anchor="middle" fill="#E65100" font-size="9" font-weight="600"
                    font-family="Montserrat">RELATIVE</text>

                <!-- Data Resources (Bottom) -->
                <rect x="80" y="260" width="120" height="45" rx="4" fill="#fff" stroke="#4CAF50" stroke-width="2" />
                <text x="140" y="277" text-anchor="middle" fill="#2E7D32" font-size="8" font-weight="600"
                    font-family="Montserrat">üìã Appointments</text>
                <text x="140" y="290" text-anchor="middle" fill="#2E7D32" font-size="6" font-family="Montserrat">patient
                    OR doctor</text>
                <text x="140" y="302" text-anchor="middle" fill="#888" font-size="5" font-style="italic"
                    font-family="Montserrat">*doctor has full control</text>

                <rect x="220" y="260" width="120" height="45" rx="4" fill="#fff" stroke="#4CAF50" stroke-width="2" />
                <text x="280" y="277" text-anchor="middle" fill="#2E7D32" font-size="8" font-weight="600"
                    font-family="Montserrat">üí¨ Messages</text>
                <text x="280" y="290" text-anchor="middle" fill="#2E7D32" font-size="6" font-family="Montserrat">patient
                    OR doctor</text>
                <text x="280" y="302" text-anchor="middle" fill="#888" font-size="5" font-style="italic"
                    font-family="Montserrat">*doctor controls state</text>

                <rect x="360" y="260" width="120" height="45" rx="4" fill="#fff" stroke="#009092" stroke-width="1.5" />
                <text x="420" y="280" text-anchor="middle" fill="#007577" font-size="8" font-weight="600"
                    font-family="Montserrat">üìÑ Documents</text>
                <text x="420" y="295" text-anchor="middle" fill="#007577" font-size="7" font-family="Montserrat">user_id
                    = auth.uid()</text>

                <rect x="500" y="260" width="130" height="45" rx="4" fill="#fff" stroke="#2196F3" stroke-width="1.5" />
                <text x="565" y="277" text-anchor="middle" fill="#1565C0" font-size="8" font-weight="600"
                    font-family="Montserrat">üè• Medical Records</text>
                <text x="565" y="290" text-anchor="middle" fill="#1565C0" font-size="6" font-family="Montserrat">patient
                    OR doctor</text>
                <text x="565" y="302" text-anchor="middle" fill="#888" font-size="5" font-style="italic"
                    font-family="Montserrat">*strict ownership check</text>

                <!-- Patient -> Data -->
                <line x1="375" y1="145" x2="140" y2="255" stroke="#4CAF50" stroke-width="1.5" stroke-dasharray="4,2"
                    marker-end="url(#arrow4g)" />
                <line x1="375" y1="145" x2="280" y2="255" stroke="#4CAF50" stroke-width="1.5" stroke-dasharray="4,2"
                    marker-end="url(#arrow4g)" />
                <line x1="375" y1="145" x2="420" y2="255" stroke="#2196F3" stroke-width="2" marker-end="url(#arrow4)" />
                <line x1="375" y1="145" x2="565" y2="255" stroke="#2196F3" stroke-width="2" marker-end="url(#arrow4)" />

                <!-- Doctor -> Data (READ/WRITE via RLS) -->
                <line x1="175" y1="215" x2="140" y2="255" stroke="#4CAF50" stroke-width="1.5" stroke-dasharray="4,2"
                    marker-end="url(#arrow4g)" />
                <line x1="185" y1="210" x2="280" y2="255" stroke="#4CAF50" stroke-width="1.5" stroke-dasharray="4,2"
                    marker-end="url(#arrow4g)" />
                <line x1="190" y1="205" x2="565" y2="255" stroke="#4CAF50" stroke-width="1.5" stroke-dasharray="4,2"
                    marker-end="url(#arrow4g)" />

                <!-- Relative -> Data (MANAGED BY PATIENT) -->
                <line x1="575" y1="215" x2="565" y2="255" stroke="#FF9800" stroke-width="1.5" stroke-dasharray="4,2"
                    marker-end="url(#arrow4o)" />
                <line x1="565" y1="215" x2="420" y2="255" stroke="#FF9800" stroke-width="1.5" stroke-dasharray="4,2"
                    marker-end="url(#arrow4o)" />

                <!-- Legend -->
                <rect x="20" y="50" width="95" height="85" rx="4" fill="#f9f9f9" stroke="#ddd" />
                <text x="67" y="65" text-anchor="middle" fill="#666" font-size="7" font-weight="600"
                    font-family="Montserrat">Access Legend</text>

                <line x1="28" y1="80" x2="50" y2="80" stroke="#2196F3" stroke-width="2" />
                <text x="58" y="83" fill="#666" font-size="6" font-family="Montserrat">Full Access</text>

                <line x1="28" y1="95" x2="50" y2="95" stroke="#4CAF50" stroke-width="1.5" stroke-dasharray="4,2" />
                <text x="58" y="98" fill="#666" font-size="6" font-family="Montserrat">Read/Write (RLS)</text>

                <line x1="28" y1="110" x2="50" y2="110" stroke="#FF9800" stroke-width="1.5" stroke-dasharray="4,2" />
                <text x="58" y="113" fill="#666" font-size="6" font-family="Montserrat">Managed</text>

                <rect x="28" y="120" width="8" height="8" rx="1" fill="#009092" />
                <text x="43" y="127" fill="#666" font-size="6" font-family="Montserrat">RLS Protected</text>

                <!-- Access Rights Labels -->
                <rect x="230" y="145" width="80" height="18" rx="9" fill="#2196F3" />
                <text x="270" y="157" text-anchor="middle" fill="#fff" font-size="7" font-family="Montserrat">FULL
                    CONTROL</text>

                <rect x="80" y="225" width="60" height="16" rx="8" fill="#4CAF50" />
                <text x="110" y="236" text-anchor="middle" fill="#fff" font-size="6" font-family="Montserrat">R/W
                    Access</text>

                <rect x="540" y="225" width="70" height="16" rx="8" fill="#FF9800" />
                <text x="575" y="236" text-anchor="middle" fill="#fff" font-size="5" font-family="Montserrat">By
                    Patient</text>
            </svg>
        </div>

        <div class="info-box">
            <strong>üîí Privacy by Design:</strong> All data access is enforced at the database level via RLS policies.
            Patients own their data; doctors access via appointments; relatives are managed profiles (not separate
            users).
        </div>

        <!-- Appointment Booking Sequence Diagram -->
        <h3>Appointment Booking Flow</h3>
        <div class="diagram-container no-break">
            <svg viewBox="0 0 750 500" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <marker id="arrow5" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
                        <polygon points="0 0, 8 3, 0 6" fill="#009092" />
                    </marker>
                    <marker id="arrow5r" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
                        <polygon points="0 0, 8 3, 0 6" fill="#4CAF50" />
                    </marker>
                </defs>

                <!-- Title -->
                <text x="375" y="20" text-anchor="middle" fill="#333" font-size="12" font-weight="600"
                    font-family="Montserrat">Appointment Booking Sequence</text>

                <!-- Actor Labels -->
                <rect x="50" y="40" width="70" height="25" rx="4" fill="#E3F2FD" stroke="#2196F3" stroke-width="1.5" />
                <text x="85" y="57" text-anchor="middle" fill="#1565C0" font-size="8" font-weight="600"
                    font-family="Montserrat">Patient</text>

                <rect x="170" y="40" width="70" height="25" rx="4" fill="#E8F5E9" stroke="#4CAF50" stroke-width="1.5" />
                <text x="205" y="57" text-anchor="middle" fill="#2E7D32" font-size="8" font-weight="600"
                    font-family="Montserrat">UI Layer</text>

                <rect x="290" y="40" width="70" height="25" rx="4" fill="#FFF3E0" stroke="#FF9800" stroke-width="1.5" />
                <text x="325" y="57" text-anchor="middle" fill="#E65100" font-size="8" font-weight="600"
                    font-family="Montserrat">Cubit</text>

                <rect x="410" y="40" width="80" height="25" rx="4" fill="#009092" />
                <text x="450" y="57" text-anchor="middle" fill="#fff" font-size="8" font-weight="600"
                    font-family="Montserrat">RPC Function</text>

                <rect x="540" y="40" width="80" height="25" rx="4" fill="#336791" />
                <text x="580" y="57" text-anchor="middle" fill="#fff" font-size="8" font-weight="600"
                    font-family="Montserrat">PostgreSQL</text>

                <rect x="660" y="40" width="70" height="25" rx="4" fill="#7B1FA2" />
                <text x="695" y="57" text-anchor="middle" fill="#fff" font-size="8" font-weight="600"
                    font-family="Montserrat">Trigger</text>

                <!-- Vertical Lifelines -->
                <line x1="85" y1="65" x2="85" y2="490" stroke="#ddd" stroke-width="1" stroke-dasharray="4,3" />
                <line x1="205" y1="65" x2="205" y2="490" stroke="#ddd" stroke-width="1" stroke-dasharray="4,3" />
                <line x1="325" y1="65" x2="325" y2="490" stroke="#ddd" stroke-width="1" stroke-dasharray="4,3" />
                <line x1="450" y1="65" x2="450" y2="490" stroke="#ddd" stroke-width="1" stroke-dasharray="4,3" />
                <line x1="580" y1="65" x2="580" y2="490" stroke="#ddd" stroke-width="1" stroke-dasharray="4,3" />
                <line x1="695" y1="65" x2="695" y2="490" stroke="#ddd" stroke-width="1" stroke-dasharray="4,3" />

                <!-- USER JOURNEY PHASE -->
                <rect x="15" y="80" width="60" height="12" rx="2" fill="#E3F2FD" />
                <text x="45" y="89" text-anchor="middle" fill="#1565C0" font-size="5" font-weight="600"
                    font-family="Montserrat">User Journey</text>

                <!-- Step 1: Open Doctor Profile -->
                <text x="20" y="110" fill="#666" font-size="7" font-family="Montserrat" font-weight="600">1</text>
                <line x1="85" y1="110" x2="200" y2="110" stroke="#009092" stroke-width="1.5"
                    marker-end="url(#arrow5)" />
                <text x="145" y="105" text-anchor="middle" fill="#007577" font-size="6" font-family="Montserrat">Open
                    Doctor Profile</text>

                <!-- Step 2: Tap "Book Appointment" -->
                <text x="20" y="135" fill="#666" font-size="7" font-family="Montserrat" font-weight="600">2</text>
                <line x1="85" y1="135" x2="200" y2="135" stroke="#009092" stroke-width="1.5"
                    marker-end="url(#arrow5)" />
                <text x="145" y="130" text-anchor="middle" fill="#007577" font-size="6" font-family="Montserrat">Tap
                    "Book Appointment"</text>

                <!-- Step 3: Select Patient (self or relative) -->
                <text x="20" y="160" fill="#666" font-size="7" font-family="Montserrat" font-weight="600">3</text>
                <line x1="85" y1="160" x2="200" y2="160" stroke="#009092" stroke-width="1.5"
                    marker-end="url(#arrow5)" />
                <text x="145" y="155" text-anchor="middle" fill="#007577" font-size="6" font-family="Montserrat">Select
                    Patient (self/relative)</text>

                <!-- Step 4: Visited Before? -->
                <text x="20" y="185" fill="#666" font-size="7" font-family="Montserrat" font-weight="600">4</text>
                <line x1="85" y1="185" x2="200" y2="185" stroke="#009092" stroke-width="1.5"
                    marker-end="url(#arrow5)" />
                <text x="145" y="180" text-anchor="middle" fill="#007577" font-size="6" font-family="Montserrat">Visited
                    Before? (yes/no)</text>

                <!-- Step 5: Select Reason -->
                <text x="20" y="210" fill="#666" font-size="7" font-family="Montserrat" font-weight="600">5</text>
                <line x1="85" y1="210" x2="200" y2="210" stroke="#009092" stroke-width="1.5"
                    marker-end="url(#arrow5)" />
                <text x="145" y="205" text-anchor="middle" fill="#007577" font-size="6" font-family="Montserrat">Select
                    Reason</text>

                <!-- Step 6: Select Time Slot -->
                <text x="20" y="235" fill="#666" font-size="7" font-family="Montserrat" font-weight="600">6</text>
                <line x1="85" y1="235" x2="200" y2="235" stroke="#009092" stroke-width="1.5"
                    marker-end="url(#arrow5)" />
                <text x="145" y="230" text-anchor="middle" fill="#007577" font-size="6" font-family="Montserrat">Select
                    Time Slot</text>

                <!-- TECHNICAL PHASE -->
                <rect x="15" y="255" width="65" height="12" rx="2" fill="#E8F5E9" />
                <text x="47" y="264" text-anchor="middle" fill="#2E7D32" font-size="5" font-weight="600"
                    font-family="Montserrat">Technical Flow</text>

                <!-- Step 7: UI Validates -->
                <text x="20" y="285" fill="#666" font-size="7" font-family="Montserrat" font-weight="600">7</text>
                <rect x="175" y="275" width="60" height="20" rx="3" fill="#E8F5E9" stroke="#4CAF50" stroke-width="1" />
                <text x="205" y="288" text-anchor="middle" fill="#2E7D32" font-size="6"
                    font-family="Montserrat">Validate Form</text>

                <!-- Step 8: Patient confirms -->
                <text x="20" y="315" fill="#666" font-size="7" font-family="Montserrat" font-weight="600">8</text>
                <line x1="85" y1="315" x2="200" y2="315" stroke="#009092" stroke-width="1.5"
                    marker-end="url(#arrow5)" />
                <text x="145" y="310" text-anchor="middle" fill="#007577" font-size="6" font-family="Montserrat">Tap
                    "Confirm"</text>

                <!-- Step 9: UI calls Cubit -->
                <text x="20" y="340" fill="#666" font-size="7" font-family="Montserrat" font-weight="600">9</text>
                <line x1="205" y1="340" x2="320" y2="340" stroke="#009092" stroke-width="1.5"
                    marker-end="url(#arrow5)" />
                <text x="262" y="335" text-anchor="middle" fill="#007577" font-size="6"
                    font-family="Montserrat">bookAppointment()</text>

                <!-- Step 10: Cubit calls RPC -->
                <text x="20" y="365" fill="#666" font-size="7" font-family="Montserrat" font-weight="600">10</text>
                <line x1="325" y1="365" x2="445" y2="365" stroke="#009092" stroke-width="1.5"
                    marker-end="url(#arrow5)" />
                <text x="385" y="360" text-anchor="middle" fill="#007577" font-size="6"
                    font-family="Montserrat">rpc('book_appointment_by_patient')</text>

                <!-- Step 11: RPC inserts to DB -->
                <text x="20" y="390" fill="#666" font-size="7" font-family="Montserrat" font-weight="600">11</text>
                <line x1="450" y1="390" x2="575" y2="390" stroke="#009092" stroke-width="1.5"
                    marker-end="url(#arrow5)" />
                <text x="512" y="385" text-anchor="middle" fill="#007577" font-size="6" font-family="Montserrat">INSERT
                    appointment</text>

                <!-- Step 12: Trigger fires -->
                <text x="20" y="415" fill="#666" font-size="7" font-family="Montserrat" font-weight="600">12</text>
                <line x1="580" y1="415" x2="690" y2="415" stroke="#7B1FA2" stroke-width="1.5"
                    marker-end="url(#arrow5)" />
                <text x="635" y="408" text-anchor="middle" fill="#7B1FA2" font-size="5"
                    font-family="Montserrat">on_appointment_insert</text>
                <text x="695" y="430" text-anchor="middle" fill="#7B1FA2" font-size="5" font-family="Montserrat">Push
                    Notification</text>

                <!-- Step 13: Return appointment_id -->
                <text x="20" y="450" fill="#666" font-size="7" font-family="Montserrat" font-weight="600">13</text>
                <line x1="575" y1="450" x2="330" y2="450" stroke="#4CAF50" stroke-width="1.5" stroke-dasharray="4,2"
                    marker-end="url(#arrow5r)" />
                <text x="452" y="445" text-anchor="middle" fill="#2E7D32" font-size="6"
                    font-family="Montserrat">appointment_id + is_confirmed</text>

                <!-- Step 14: Return to UI -->
                <text x="20" y="480" fill="#666" font-size="7" font-family="Montserrat" font-weight="600">14</text>
                <line x1="320" y1="480" x2="90" y2="480" stroke="#4CAF50" stroke-width="1.5" stroke-dasharray="4,2"
                    marker-end="url(#arrow5r)" />
                <text x="205" y="475" text-anchor="middle" fill="#2E7D32" font-size="6"
                    font-family="Montserrat">Navigate: Confirmed / Waiting</text>

                <!-- Legend -->
                <rect x="640" y="80" width="95" height="55" rx="3" fill="#f9f9f9" stroke="#ddd" />
                <text x="687" y="93" text-anchor="middle" fill="#666" font-size="6" font-weight="600"
                    font-family="Montserrat">Legend</text>
                <line x1="650" y1="105" x2="670" y2="105" stroke="#009092" stroke-width="1.5" />
                <text x="677" y="108" fill="#666" font-size="5" font-family="Montserrat">Request</text>
                <line x1="650" y1="118" x2="670" y2="118" stroke="#4CAF50" stroke-width="1.5" stroke-dasharray="4,2" />
                <text x="677" y="121" fill="#666" font-size="5" font-family="Montserrat">Response</text>
                <line x1="650" y1="131" x2="670" y2="131" stroke="#7B1FA2" stroke-width="1.5" />
                <text x="677" y="134" fill="#666" font-size="5" font-family="Montserrat">Trigger</text>
            </svg>
        </div>

        <!-- 2. Frontend -->
        <h2>2. Frontend Stack</h2>

        <table>
            <tr>
                <th>Technology</th>
                <th>Version</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>Flutter</code></td>
                <td>SDK ‚â•3.6.0 &lt;4.0.0</td>
                <td>Cross-platform UI framework</td>
            </tr>
            <tr>
                <td><code>Dart</code></td>
                <td>Latest stable</td>
                <td>Programming language</td>
            </tr>
            <tr>
                <td><code>flutter_bloc</code></td>
                <td>^9.1.0</td>
                <td>State management (Cubit pattern)</td>
            </tr>
            <tr>
                <td><code>flutter_screenutil</code></td>
                <td>^5.9.3</td>
                <td>Responsive UI scaling</td>
            </tr>
        </table>

        <h3>Typography</h3>
        <table>
            <tr>
                <th>Font</th>
                <th>Language</th>
                <th>Direction</th>
                <th>Weights</th>
            </tr>
            <tr>
                <td><strong>Montserrat</strong></td>
                <td>English</td>
                <td>LTR</td>
                <td>300, 400, 500, 600, 700</td>
            </tr>
            <tr>
                <td><strong>Cairo</strong></td>
                <td>Arabic</td>
                <td>RTL</td>
                <td>100, 300, 400, 500, 600, 700, 900</td>
            </tr>
        </table>

        <!-- 3. Backend -->
        <h2>3. Backend Infrastructure</h2>

        <table>
            <tr>
                <th>Technology</th>
                <th>Details</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><strong>Supabase</strong></td>
                <td>Cloud-hosted</td>
                <td>Backend-as-a-Service platform</td>
            </tr>
            <tr>
                <td><strong>PostgreSQL</strong></td>
                <td>Version 15</td>
                <td>Primary relational database</td>
            </tr>
            <tr>
                <td><strong>Supabase Auth</strong></td>
                <td>Email/Password + OTP<br><em>(Phone OTP login planned)</em></td>
                <td>Primary login with OTP for verification; Phone + OTP login coming soon</td>
            </tr>
            <tr>
                <td><strong>Supabase Realtime</strong></td>
                <td>Postgres Changes, Broadcast</td>
                <td>Live data subscriptions for messages, appointments</td>
            </tr>
            <tr>
                <td><strong>Supabase Storage</strong></td>
                <td>6 buckets</td>
                <td>File/document storage</td>
            </tr>
            <tr>
                <td><strong>Edge Functions</strong></td>
                <td>Deno/TypeScript (3 functions)</td>
                <td>Serverless backend logic</td>
            </tr>
            <tr>
                <td><strong>Pushy</strong></td>
                <td>pushy_flutter SDK</td>
                <td>Push notifications (iOS & Android)</td>
            </tr>
        </table>

        <h3>Storage Buckets</h3>
        <table>
            <tr>
                <th>Bucket</th>
                <th>Purpose</th>
                <th>Public</th>
            </tr>
            <tr>
                <td><code>documents</code></td>
                <td>User medical documents (5MB limit)</td>
                <td>‚úì</td>
            </tr>
            <tr>
                <td><code>chat.attachments</code></td>
                <td>Chat message images, PDFs, voice notes</td>
                <td>‚úì</td>
            </tr>
            <tr>
                <td><code>doctor</code></td>
                <td>Doctor profile images and galleries</td>
                <td>‚úì</td>
            </tr>
            <tr>
                <td><code>appointments-attachments</code></td>
                <td>Appointment-related files</td>
                <td>‚úì</td>
            </tr>
            <tr>
                <td><code>banners</code></td>
                <td>Home page promotional banner images</td>
                <td>‚úì</td>
            </tr>
            <tr>
                <td><code>home_cards</code></td>
                <td>Home page feature card images</td>
                <td>‚úì</td>
            </tr>
        </table>

        <!-- 4. State Management -->
        <h2>4. State Management (BLoC Pattern)</h2>
        <p>DocSera implements the BLoC pattern using Cubits for predictable, testable state management.</p>

        <table>
            <tr>
                <th>Cubit</th>
                <th>Responsibility</th>
            </tr>
            <tr>
                <td><code>AuthCubit</code></td>
                <td>Authentication state, login/logout flows</td>
            </tr>
            <tr>
                <td><code>MainScreenCubit</code></td>
                <td>Home screen data loading</td>
            </tr>
            <tr>
                <td><code>AppointmentsCubit</code></td>
                <td>Appointment management</td>
            </tr>
            <tr>
                <td><code>MessagesCubit</code></td>
                <td>Conversations list and messaging overview</td>
            </tr>
            <tr>
                <td><code>ConversationCubit</code></td>
                <td>Individual conversation and real-time messages</td>
            </tr>
            <tr>
                <td><code>DocumentsCubit</code></td>
                <td>Medical document management</td>
            </tr>
            <tr>
                <td><code>NotesCubit</code></td>
                <td>Patient notes handling</td>
            </tr>
            <tr>
                <td><code>UserCubit</code></td>
                <td>User profile and preferences</td>
            </tr>
            <tr>
                <td><code>PatientSwitcherCubit</code></td>
                <td>Multi-patient (relatives) switching</td>
            </tr>
            <tr>
                <td><code>RelativesCubit</code></td>
                <td>Family member management</td>
            </tr>
            <tr>
                <td><code>HealthCubit</code></td>
                <td>Patient medical records management</td>
            </tr>
            <tr>
                <td><code>VisitReportsCubit</code></td>
                <td>Visit reports viewing and filtering</td>
            </tr>
            <tr>
                <td><code>DoctorScheduleCubit</code></td>
                <td>Doctor availability management</td>
            </tr>
            <tr>
                <td><code>BannersCubit</code></td>
                <td>Home page promotional banners</td>
            </tr>
            <tr>
                <td><code>HomeCardsCubit</code></td>
                <td>Home page feature cards</td>
            </tr>
            <tr>
                <td><code>PopupBannerCubit</code></td>
                <td>In-app announcements and updates</td>
            </tr>
            <tr>
                <td><code>AccountProfileCubit</code></td>
                <td>Profile settings</td>
            </tr>
            <tr>
                <td><code>AccountSecurityCubit</code></td>
                <td>Security settings (2FA, biometrics)</td>
            </tr>
            <tr>
                <td><code>AccountDangerCubit</code></td>
                <td>Account deletion/deactivation</td>
            </tr>
        </table>

        <div class="page-break"></div>

        <!-- 5. Database Schema -->
        <h2>5. Database Schema</h2>

        <h3>Tables Used by DocSera Patient App (20 tables)</h3>
        <table>
            <tr>
                <th>Table</th>
                <th>Purpose</th>
                <th>RLS Status</th>
            </tr>
            <tr>
                <td><code>users</code></td>
                <td>Patient profiles</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>doctors</code></td>
                <td>Doctor public profiles</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>appointments</code></td>
                <td>Appointment bookings</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>appointment_reasons</code></td>
                <td>Booking reasons</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>reason_time_slots</code></td>
                <td>Reason-specific time slots</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>conversations</code></td>
                <td>Chat threads</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>messages</code></td>
                <td>Chat messages</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>message_reasons</code></td>
                <td>Conversation topics</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>doctor_patient_blocks</code></td>
                <td>Message blocking</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>documents</code></td>
                <td>Medical documents</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>notes</code></td>
                <td>Patient notes</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>relatives</code></td>
                <td>Family members</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>banners</code></td>
                <td>Home page banners</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>home_cards</code></td>
                <td>Home action cards</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>popup_banners</code></td>
                <td>In-app popups</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>user_devices</code></td>
                <td>Push notification tokens</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>doctor_vacations</code></td>
                <td>Doctor unavailability</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>email_otps</code></td>
                <td>Email OTP codes (hashed)</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>otp_rate_limits</code></td>
                <td>OTP rate limiting (IP-based)</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>otp</code></td>
                <td>Phone OTP codes (debug only)</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
        </table>

        <div class="info-box">
            <strong>üì± Phone OTP Note:</strong> The <code>otp</code> table stores plain-text OTP codes for local
            debugging.
            A third-party SMS provider will replace this before production release.
        </div>

        <h3>Tables Used by DocSera Pro Only (15 tables)</h3>
        <table>
            <tr>
                <th>Table</th>
                <th>Purpose</th>
                <th>RLS Status</th>
            </tr>
            <tr>
                <td><code>doctor_accounts</code></td>
                <td>Clinic accounts</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>doctor_members</code></td>
                <td>Team members</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>team_profiles</code></td>
                <td>Staff profiles</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>doctor_patients</code></td>
                <td>Manual patients</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>doctor_patient_links</code></td>
                <td>Patient relationships</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>doctor_account_patients</code></td>
                <td>Account-level patient tracking</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>accounting</code></td>
                <td>Financial records</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>accounting_labels</code></td>
                <td>Expense categories</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>default_accounting_labels</code></td>
                <td>System default expense labels</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>doctor_reports</code></td>
                <td>Generated visit reports</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>doctor_report_templates</code></td>
                <td>Custom report templates</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>default_report_templates</code></td>
                <td>System default report templates</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>points_history</code></td>
                <td>User rewards log</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>todo_tasks</code></td>
                <td>Doctor to-do list</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>medical_master</code></td>
                <td>Medical conditions catalog</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>patient_medical_records</code></td>
                <td>Health records</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
        </table>

        <div class="warning-box">
            <strong>‚ö†Ô∏è Security Note:</strong> Tables marked "Pending" will have Row Level Security policies added
            before production release.
        </div>

        <!-- 6. Entity Relationships -->
        <h2>6. Entity Relationships</h2>

        <div class="diagram-container no-break">
            <div class="diagram-title">DocSera Patient App - Complete Entity Relationships</div>
            <svg viewBox="0 0 820 720" xmlns="http://www.w3.org/2000/svg">
                <!-- ========== USERS (Central Entity) ========== -->
                <rect x="340" y="200" width="140" height="60" rx="6" fill="#e6f7f7" stroke="#009092"
                    stroke-width="2.5" />
                <text x="410" y="220" text-anchor="middle" fill="#007577" font-size="14" font-family="Montserrat"
                    font-weight="700">users</text>
                <text x="410" y="238" text-anchor="middle" fill="#666" font-size="8" font-family="Montserrat">id,
                    email,
                    phone, name</text>
                <text x="410" y="250" text-anchor="middle" fill="#666" font-size="8"
                    font-family="Montserrat">favorites[], points</text>

                <!-- ========== TOP ROW - DOCTORS ========== -->
                <rect x="340" y="30" width="140" height="55" rx="6" fill="#e6f7f7" stroke="#009092"
                    stroke-width="2.5" />
                <text x="410" y="50" text-anchor="middle" fill="#007577" font-size="14" font-family="Montserrat"
                    font-weight="700">doctors</text>
                <text x="410" y="68" text-anchor="middle" fill="#666" font-size="8" font-family="Montserrat">id,
                    name,
                    specialty</text>
                <text x="410" y="78" text-anchor="middle" fill="#666" font-size="8"
                    font-family="Montserrat">opening_hours, location</text>

                <!-- users -> doctors (favorites array) -->
                <line x1="410" y1="200" x2="410" y2="85" stroke="#009092" stroke-width="1.5" stroke-dasharray="4,2" />
                <text x="425" y="145" fill="#666" font-size="8" font-family="Montserrat"
                    font-style="italic">favorites[]</text>

                <!-- DOCTOR_VACATIONS -->
                <rect x="520" y="30" width="100" height="40" rx="5" fill="#fff" stroke="#009092" stroke-width="1.5" />
                <text x="570" y="48" text-anchor="middle" fill="#007577" font-size="9" font-family="Montserrat"
                    font-weight="600">doctor_vacations</text>
                <text x="570" y="60" text-anchor="middle" fill="#666" font-size="7" font-family="Montserrat">start_date,
                    end_date</text>

                <!-- doctors -> doctor_vacations -->
                <line x1="480" y1="55" x2="520" y2="50" stroke="#009092" stroke-width="1.5" />
                <circle cx="480" cy="55" r="3" fill="#009092" />
                <text x="495" y="45" fill="#009092" font-size="7" font-family="Montserrat">1:N</text>

                <!-- ========== LEFT COLUMN - USER DATA ========== -->

                <!-- RELATIVES -->
                <rect x="40" y="120" width="120" height="50" rx="5" fill="#fff" stroke="#009092" stroke-width="1.5" />
                <text x="100" y="140" text-anchor="middle" fill="#007577" font-size="11" font-family="Montserrat"
                    font-weight="600">relatives</text>
                <text x="100" y="155" text-anchor="middle" fill="#666" font-size="7" font-family="Montserrat">user_id,
                    name, dob, gender</text>

                <!-- users -> relatives -->
                <line x1="340" y1="220" x2="160" y2="145" stroke="#009092" stroke-width="1.5" />
                <circle cx="340" cy="220" r="4" fill="#009092" />
                <text x="240" y="170" fill="#009092" font-size="8" font-family="Montserrat" font-weight="600">1:N</text>
                <text x="240" y="182" fill="#666" font-size="7" font-family="Montserrat">manages</text>

                <!-- DOCUMENTS -->
                <rect x="40" y="200" width="120" height="50" rx="5" fill="#fff" stroke="#009092" stroke-width="1.5" />
                <text x="100" y="220" text-anchor="middle" fill="#007577" font-size="11" font-family="Montserrat"
                    font-weight="600">documents</text>
                <text x="100" y="235" text-anchor="middle" fill="#666" font-size="7" font-family="Montserrat">user_id,
                    name, type, pages[]</text>

                <!-- users -> documents -->
                <line x1="340" y1="230" x2="160" y2="225" stroke="#009092" stroke-width="1.5" />
                <circle cx="340" cy="230" r="4" fill="#009092" />
                <text x="240" y="218" fill="#009092" font-size="8" font-family="Montserrat" font-weight="600">1:N</text>
                <text x="240" y="230" fill="#666" font-size="7" font-family="Montserrat">uploads</text>

                <!-- NOTES -->
                <rect x="40" y="280" width="120" height="45" rx="5" fill="#fff" stroke="#009092" stroke-width="1.5" />
                <text x="100" y="298" text-anchor="middle" fill="#007577" font-size="11" font-family="Montserrat"
                    font-weight="600">notes</text>
                <text x="100" y="313" text-anchor="middle" fill="#666" font-size="7" font-family="Montserrat">user_id,
                    title, content</text>

                <!-- users -> notes -->
                <line x1="340" y1="245" x2="160" y2="295" stroke="#009092" stroke-width="1.5" />
                <circle cx="340" cy="245" r="4" fill="#009092" />
                <text x="240" y="275" fill="#009092" font-size="8" font-family="Montserrat" font-weight="600">1:N</text>

                <!-- ========== RIGHT COLUMN - DEVICES ========== -->

                <!-- USER_DEVICES -->
                <rect x="640" y="170" width="120" height="45" rx="5" fill="#fff" stroke="#009092" stroke-width="1.5" />
                <text x="700" y="188" text-anchor="middle" fill="#007577" font-size="10" font-family="Montserrat"
                    font-weight="600">user_devices</text>
                <text x="700" y="203" text-anchor="middle" fill="#666" font-size="7" font-family="Montserrat">user_id,
                    token, platform</text>

                <!-- users -> user_devices -->
                <line x1="480" y1="220" x2="640" y2="190" stroke="#009092" stroke-width="1.5" />
                <circle cx="480" cy="220" r="4" fill="#009092" />
                <text x="560" y="195" fill="#009092" font-size="8" font-family="Montserrat" font-weight="600">1:N</text>
                <text x="560" y="207" fill="#666" font-size="7" font-family="Montserrat">registers</text>

                <!-- ========== CENTER - APPOINTMENTS CLUSTER ========== -->

                <!-- APPOINTMENTS -->
                <rect x="260" y="360" width="150" height="70" rx="6" fill="#e6f7f7" stroke="#009092" stroke-width="2" />
                <text x="335" y="380" text-anchor="middle" fill="#007577" font-size="12" font-family="Montserrat"
                    font-weight="700">appointments</text>
                <text x="335" y="395" text-anchor="middle" fill="#666" font-size="7" font-family="Montserrat">user_id,
                    doctor_id</text>
                <text x="335" y="407" text-anchor="middle" fill="#666" font-size="7"
                    font-family="Montserrat">relative_id?, reason_id</text>
                <text x="335" y="419" text-anchor="middle" fill="#666" font-size="7" font-family="Montserrat">date,
                    time, status</text>

                <!-- users -> appointments -->
                <line x1="380" y1="260" x2="335" y2="360" stroke="#009092" stroke-width="1.5" />
                <circle cx="380" cy="260" r="4" fill="#009092" />
                <text x="340" y="310" fill="#009092" font-size="8" font-family="Montserrat" font-weight="600">1:N</text>
                <text x="340" y="322" fill="#666" font-size="7" font-family="Montserrat">books</text>

                <!-- doctors -> appointments -->
                <line x1="360" y1="85" x2="300" y2="360" stroke="#009092" stroke-width="1.5" />
                <text x="305" y="220" fill="#009092" font-size="8" font-family="Montserrat" font-weight="600">1:N</text>
                <text x="305" y="232" fill="#666" font-size="7" font-family="Montserrat">receives</text>

                <!-- relatives -> appointments (optional) -->
                <line x1="100" y1="170" x2="260" y2="390" stroke="#009092" stroke-width="1.5" stroke-dasharray="4,2" />
                <text x="160" y="300" fill="#666" font-size="7" font-family="Montserrat">patient? (0:N)</text>

                <!-- APPOINTMENT_REASONS -->
                <rect x="80" y="400" width="130" height="50" rx="5" fill="#fff" stroke="#009092" stroke-width="1.5" />
                <text x="145" y="418" text-anchor="middle" fill="#007577" font-size="9" font-family="Montserrat"
                    font-weight="600">appointment_reasons</text>
                <text x="145" y="433" text-anchor="middle" fill="#666" font-size="7" font-family="Montserrat">doctor_id,
                    label</text>

                <!-- appointments -> appointment_reasons -->
                <line x1="260" y1="400" x2="210" y2="415" stroke="#009092" stroke-width="1.5" />
                <circle cx="260" cy="400" r="3" fill="#009092" />
                <text x="225" y="400" fill="#009092" font-size="8" font-family="Montserrat" font-weight="600">N:1</text>

                <!-- REASON_TIME_SLOTS -->
                <rect x="80" y="470" width="130" height="45" rx="5" fill="#fff" stroke="#009092" stroke-width="1.5" />
                <text x="145" y="488" text-anchor="middle" fill="#007577" font-size="9" font-family="Montserrat"
                    font-weight="600">reason_time_slots</text>
                <text x="145" y="503" text-anchor="middle" fill="#666" font-size="7" font-family="Montserrat">reason_id,
                    day, start, end</text>

                <!-- appointment_reasons -> reason_time_slots -->
                <line x1="145" y1="450" x2="145" y2="470" stroke="#009092" stroke-width="1.5" />
                <circle cx="145" cy="450" r="3" fill="#009092" />
                <text x="155" y="462" fill="#009092" font-size="7" font-family="Montserrat">1:N</text>

                <!-- ========== RIGHT - MESSAGING CLUSTER ========== -->

                <!-- CONVERSATIONS -->
                <rect x="480" y="360" width="150" height="70" rx="6" fill="#e6f7f7" stroke="#009092" stroke-width="2" />
                <text x="555" y="380" text-anchor="middle" fill="#007577" font-size="12" font-family="Montserrat"
                    font-weight="700">conversations</text>
                <text x="555" y="395" text-anchor="middle" fill="#666" font-size="7"
                    font-family="Montserrat">patient_id, doctor_id</text>
                <text x="555" y="407" text-anchor="middle" fill="#666" font-size="7"
                    font-family="Montserrat">relative_id?, reason_id?</text>
                <text x="555" y="419" text-anchor="middle" fill="#666" font-size="7"
                    font-family="Montserrat">last_message, is_closed</text>

                <!-- users -> conversations -->
                <line x1="440" y1="260" x2="520" y2="360" stroke="#009092" stroke-width="1.5" />
                <circle cx="440" cy="260" r="4" fill="#009092" />
                <text x="495" y="310" fill="#009092" font-size="8" font-family="Montserrat" font-weight="600">1:N</text>
                <text x="495" y="322" fill="#666" font-size="7" font-family="Montserrat">participates</text>

                <!-- doctors -> conversations -->
                <line x1="460" y1="85" x2="580" y2="360" stroke="#009092" stroke-width="1.5" />
                <text x="535" y="220" fill="#009092" font-size="8" font-family="Montserrat" font-weight="600">1:N</text>
                <text x="535" y="232" fill="#666" font-size="7" font-family="Montserrat">responds</text>

                <!-- MESSAGES -->
                <rect x="480" y="470" width="140" height="50" rx="5" fill="#fff" stroke="#009092" stroke-width="1.5" />
                <text x="550" y="490" text-anchor="middle" fill="#007577" font-size="11" font-family="Montserrat"
                    font-weight="600">messages</text>
                <text x="550" y="505" text-anchor="middle" fill="#666" font-size="7"
                    font-family="Montserrat">conversation_id, text, attachments</text>

                <!-- conversations -> messages -->
                <line x1="550" y1="430" x2="550" y2="470" stroke="#009092" stroke-width="1.5" />
                <circle cx="550" cy="430" r="4" fill="#009092" />
                <text x="565" y="450" fill="#009092" font-size="8" font-family="Montserrat" font-weight="600">1:N</text>
                <text x="565" y="462" fill="#666" font-size="7" font-family="Montserrat">contains</text>

                <!-- MESSAGE_REASONS -->
                <rect x="660" y="380" width="110" height="40" rx="5" fill="#fff" stroke="#009092" stroke-width="1.5" />
                <text x="715" y="398" text-anchor="middle" fill="#007577" font-size="9" font-family="Montserrat"
                    font-weight="600">message_reasons</text>
                <text x="715" y="412" text-anchor="middle" fill="#666" font-size="7" font-family="Montserrat">doctor_id,
                    label</text>

                <!-- conversations -> message_reasons -->
                <line x1="630" y1="390" x2="660" y2="395" stroke="#009092" stroke-width="1.5" stroke-dasharray="4,2" />
                <text x="640" y="383" fill="#666" font-size="7" font-family="Montserrat">N:1?</text>

                <!-- ========== BOTTOM - MEDICAL RECORDS ========== -->

                <!-- PATIENT_MEDICAL_RECORDS -->
                <rect x="260" y="550" width="160" height="65" rx="6" fill="#e6f7f7" stroke="#009092" stroke-width="2" />
                <text x="340" y="568" text-anchor="middle" fill="#007577" font-size="10" font-family="Montserrat"
                    font-weight="700">patient_medical_records</text>
                <text x="340" y="582" text-anchor="middle" fill="#666" font-size="7"
                    font-family="Montserrat">patient_id, master_id</text>
                <text x="340" y="594" text-anchor="middle" fill="#666" font-size="7"
                    font-family="Montserrat">relative_id?, severity</text>
                <text x="340" y="606" text-anchor="middle" fill="#666" font-size="7"
                    font-family="Montserrat">created_by_doctor_id?</text>

                <!-- users -> patient_medical_records -->
                <line x1="410" y1="260" x2="340" y2="550" stroke="#009092" stroke-width="1.5" />
                <text x="355" y="420" fill="#009092" font-size="8" font-family="Montserrat" font-weight="600">1:N</text>
                <text x="355" y="432" fill="#666" font-size="7" font-family="Montserrat">has records</text>

                <!-- relatives -> patient_medical_records (optional) -->
                <line x1="100" y1="170" x2="260" y2="580" stroke="#009092" stroke-width="1" stroke-dasharray="3,2" />

                <!-- MEDICAL_MASTER -->
                <rect x="80" y="560" width="130" height="50" rx="5" fill="#f0f9fa" stroke="#009092"
                    stroke-width="1.5" />
                <text x="145" y="578" text-anchor="middle" fill="#007577" font-size="10" font-family="Montserrat"
                    font-weight="600">medical_master</text>
                <text x="145" y="593" text-anchor="middle" fill="#666" font-size="7" font-family="Montserrat">category,
                    type, name</text>
                <text x="145" y="603" text-anchor="middle" fill="#666" font-size="8" font-family="Montserrat"
                    font-style="italic">(catalog)</text>

                <!-- patient_medical_records -> medical_master -->
                <line x1="260" y1="582" x2="210" y2="580" stroke="#009092" stroke-width="1.5" />
                <circle cx="260" cy="582" r="3" fill="#009092" />
                <text x="230" y="570" fill="#009092" font-size="8" font-family="Montserrat" font-weight="600">N:1</text>

                <!-- ========== FAR RIGHT - CONFIG TABLES ========== -->

                <rect x="680" y="520" width="90" height="30" rx="5" fill="#f5f5f5" stroke="#999" stroke-width="1" />
                <text x="725" y="539" text-anchor="middle" fill="#666" font-size="9"
                    font-family="Montserrat">banners</text>

                <rect x="680" y="560" width="90" height="30" rx="5" fill="#f5f5f5" stroke="#999" stroke-width="1" />
                <text x="725" y="579" text-anchor="middle" fill="#666" font-size="9"
                    font-family="Montserrat">home_cards</text>

                <rect x="680" y="600" width="90" height="30" rx="5" fill="#f5f5f5" stroke="#999" stroke-width="1" />
                <text x="725" y="619" text-anchor="middle" fill="#666" font-size="8"
                    font-family="Montserrat">popup_banners</text>

                <text x="725" y="650" text-anchor="middle" fill="#999" font-size="8" font-family="Montserrat"
                    font-style="italic">(app config)</text>

                <!-- ========== LEGEND ========== -->
                <rect x="40" y="660" width="730" height="50" rx="6" fill="#fafafa" stroke="#ddd" />
                <text x="60" y="680" fill="#333" font-size="10" font-family="Montserrat"
                    font-weight="600">Legend:</text>

                <rect x="110" y="673" width="18" height="14" rx="3" fill="#e6f7f7" stroke="#009092" stroke-width="2" />
                <text x="133" y="685" fill="#666" font-size="8" font-family="Montserrat">Primary</text>

                <rect x="180" y="673" width="18" height="14" rx="3" fill="#fff" stroke="#009092" />
                <text x="203" y="685" fill="#666" font-size="8" font-family="Montserrat">Related</text>

                <rect x="250" y="673" width="18" height="14" rx="3" fill="#f0f9fa" stroke="#009092" />
                <text x="273" y="685" fill="#666" font-size="8" font-family="Montserrat">Catalog</text>

                <line x1="330" y1="680" x2="360" y2="680" stroke="#009092" stroke-width="1.5" />
                <circle cx="330" cy="680" r="3" fill="#009092" />
                <text x="365" y="685" fill="#666" font-size="8" font-family="Montserrat">1:N FK</text>

                <line x1="420" y1="680" x2="450" y2="680" stroke="#009092" stroke-width="1.5" stroke-dasharray="4,2" />
                <text x="455" y="685" fill="#666" font-size="8" font-family="Montserrat">Optional (nullable)</text>

                <rect x="545" y="673" width="18" height="14" rx="3" fill="#f5f5f5" stroke="#999" />
                <text x="568" y="685" fill="#666" font-size="8" font-family="Montserrat">Config</text>
            </svg>
        </div>








        <h3>Key Foreign Key Relationships</h3>
        <table>
            <tr>
                <th>From Table</th>
                <th>Column</th>
                <th>References</th>
                <th>Cardinality</th>
            </tr>
            <tr>
                <td>appointments</td>
                <td>user_id</td>
                <td>users.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>appointments</td>
                <td>doctor_id</td>
                <td>doctors.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>appointments</td>
                <td>relative_id</td>
                <td>relatives.id</td>
                <td>many-to-one (nullable)</td>
            </tr>
            <tr>
                <td>appointments</td>
                <td>reason_id</td>
                <td>appointment_reasons.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>conversations</td>
                <td>patient_id</td>
                <td>users.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>conversations</td>
                <td>doctor_id</td>
                <td>doctors.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>messages</td>
                <td>conversation_id</td>
                <td>conversations.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>relatives</td>
                <td>user_id</td>
                <td>users.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>documents</td>
                <td>user_id</td>
                <td>users.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>notes</td>
                <td>user_id</td>
                <td>users.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>user_devices</td>
                <td>user_id</td>
                <td>users.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>doctor_vacations</td>
                <td>doctor_id</td>
                <td>doctors.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>appointment_reasons</td>
                <td>doctor_id</td>
                <td>doctors.id</td>
                <td>many-to-one (nullable)</td>
            </tr>
            <tr>
                <td>reason_time_slots</td>
                <td>doctor_id</td>
                <td>doctors.id</td>
                <td>many-to-one (nullable)</td>
            </tr>
            <tr>
                <td>reason_time_slots</td>
                <td>reason_id</td>
                <td>appointment_reasons.id</td>
                <td>many-to-one (nullable)</td>
            </tr>
            <tr>
                <td>conversations</td>
                <td>relative_id</td>
                <td>relatives.id</td>
                <td>many-to-one (nullable)</td>
            </tr>
            <tr>
                <td>conversations</td>
                <td>reason_id</td>
                <td>message_reasons.id</td>
                <td>many-to-one (nullable)</td>
            </tr>
            <tr>
                <td>message_reasons</td>
                <td>doctor_id</td>
                <td>doctors.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>patient_medical_records</td>
                <td>patient_id</td>
                <td>users.id</td>
                <td>many-to-one (nullable)</td>
            </tr>
            <tr>
                <td>patient_medical_records</td>
                <td>master_id</td>
                <td>medical_master.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>patient_medical_records</td>
                <td>relative_id</td>
                <td>relatives.id</td>
                <td>many-to-one (nullable)</td>
            </tr>
            <tr>
                <td>patient_medical_records</td>
                <td>created_by_doctor_id</td>
                <td>doctors.id</td>
                <td>many-to-one (nullable)</td>
            </tr>
        </table>

        <div class="page-break"></div>

        <!-- 7. Views -->
        <h2>7. Database Views</h2>

        <div class="info-box">
            <strong>üìã Note:</strong> These views are primarily used by <strong>DocSera Pro</strong> for
            clinic/doctor
            management.
            The Patient App queries tables directly via RPC functions.
        </div>

        <table>
            <tr>
                <th>View</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>v_my_membership</code></td>
                <td>Current user's doctor membership & role</td>
            </tr>
            <tr>
                <td><code>v_team_members</code></td>
                <td>Team members with profile data joined</td>
            </tr>
            <tr>
                <td><code>v_doctor_members_safe</code></td>
                <td>Safe member listing without sensitive data</td>
            </tr>
            <tr>
                <td><code>v_doctor_patients_full</code></td>
                <td>Unified patient view (user/relative/manual)</td>
            </tr>
            <tr>
                <td><code>v_clinic_patients_searchable</code></td>
                <td>Searchable patient list for clinics</td>
            </tr>
        </table>

        <!-- 8. RPC Functions -->
        <h2>8. RPC Functions Used by DocSera</h2>

        <h3>Appointment Management</h3>
        <table>
            <tr>
                <th>Function</th>
                <th>Purpose</th>
                <th>Security</th>
            </tr>
            <tr>
                <td><code>book_appointment_by_patient</code></td>
                <td>Book new appointment with doctor</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>cancel_appointment_by_patient</code></td>
                <td>Cancel existing appointment</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>get_available_slots</code></td>
                <td>Get doctor's available time slots</td>
                <td>INVOKER</td>
            </tr>
            <tr>
                <td><code>add_appointment_attachment</code></td>
                <td>Add files to appointment</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>remove_appointment_attachment</code></td>
                <td>Remove appointment files</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>reschedule_appointment_by_patient</code></td>
                <td>Reschedule existing appointment</td>
                <td>DEFINER</td>
            </tr>
        </table>

        <h3>User Profile Management</h3>
        <table>
            <tr>
                <th>Function</th>
                <th>Purpose</th>
                <th>Security</th>
            </tr>
            <tr>
                <td><code>rpc_get_my_user</code></td>
                <td>Get current user profile</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>rpc_update_my_user</code></td>
                <td>Update user profile</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>rpc_get_my_security_state</code></td>
                <td>Get security settings</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>rpc_get_my_patient_context</code></td>
                <td>Get patient booking context</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>rpc_deactivate_my_account</code></td>
                <td>Deactivate user account</td>
                <td>DEFINER</td>
            </tr>
        </table>

        <h3>Relatives Management</h3>
        <table>
            <tr>
                <th>Function</th>
                <th>Purpose</th>
                <th>Security</th>
            </tr>
            <tr>
                <td><code>rpc_get_my_relatives</code></td>
                <td>List family members</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>rpc_add_my_relative</code></td>
                <td>Add family member</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>rpc_update_my_relative</code></td>
                <td>Update family member</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>rpc_deactivate_my_relative</code></td>
                <td>Soft delete family member</td>
                <td>DEFINER</td>
            </tr>
        </table>

        <h3>Favorites & Messaging</h3>
        <table>
            <tr>
                <th>Function</th>
                <th>Purpose</th>
                <th>Security</th>
            </tr>
            <tr>
                <td><code>rpc_get_my_favorite_doctors</code></td>
                <td>Get saved/favorite doctors</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>toggle_favorite_doctor</code></td>
                <td>Save or unsave a doctor</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>rpc_mark_messages_read</code></td>
                <td>Mark messages as read</td>
                <td>DEFINER</td>
            </tr>
        </table>

        <h3>Authentication</h3>
        <table>
            <tr>
                <th>Function</th>
                <th>Purpose</th>
                <th>Security</th>
            </tr>
            <tr>
                <td><code>phone_exists</code></td>
                <td>Check if phone is registered</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>email_exists</code></td>
                <td>Check if email is registered</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>send_login_otp</code></td>
                <td>Request login OTP code</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>verify_login_otp</code></td>
                <td>Verify OTP code</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>trust_current_device</code></td>
                <td>Mark device as trusted</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>rpc_get_login_info</code></td>
                <td>Get login info by identifier</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>rpc_verify_email_otp</code></td>
                <td>Verify email OTP (hashed)</td>
                <td>DEFINER</td>
            </tr>
        </table>

        <!-- 9. Edge Functions -->
        <h2>9. Edge Functions</h2>

        <table>
            <tr>
                <th>Function</th>
                <th>Purpose</th>
                <th>Authentication</th>
            </tr>
            <tr>
                <td><code>send_email_otp</code></td>
                <td>Generate OTP via rpc_create_email_otp, send via SMTP</td>
                <td>Public (no JWT)</td>
            </tr>
            <tr>
                <td><code>push_notifications</code></td>
                <td>Handle messages/appointments/documents notifications via Pushy</td>
                <td>Service Role (webhook)</td>
            </tr>
            <tr>
                <td><code>update_email_admin</code></td>
                <td>Update email in auth.users + sync to public.users</td>
                <td>JWT Required</td>
            </tr>
        </table>

        <!-- 10. Triggers -->
        <h2>10. Database Triggers</h2>

        <h3>Shared Triggers (Both Apps)</h3>
        <table>
            <tr>
                <th>Trigger</th>
                <th>Table</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>trg_sync_appointment_local_fields</code></td>
                <td>appointments</td>
                <td>Convert UTC timestamp to local date/time (GMT+3)</td>
            </tr>
            <tr>
                <td><code>trg_prevent_double_booking</code></td>
                <td>appointments</td>
                <td>Raise exception if slot already booked</td>
            </tr>
            <tr>
                <td><code>trg_set_appointment_defaults</code></td>
                <td>appointments</td>
                <td>Set duration and end_time from doctor settings</td>
            </tr>
            <tr>
                <td><code>trg_set_appointment_doctor_account_id</code></td>
                <td>appointments</td>
                <td>Auto-fill doctor_account_id from doctors table</td>
            </tr>
            <tr>
                <td><code>trg_upsert_patient_links_from_appointments</code></td>
                <td>appointments</td>
                <td>Upsert to doctor_patient_links and doctor_account_patients</td>
            </tr>
            <tr>
                <td><code>appointment-updates</code></td>
                <td>appointments</td>
                <td>HTTP call to push_notifications Edge Function</td>
            </tr>
            <tr>
                <td><code>on_new_message</code></td>
                <td>messages</td>
                <td>Update conversation last_message, unread counts</td>
            </tr>
            <tr>
                <td><code>push_messages</code></td>
                <td>messages</td>
                <td>HTTP call to push_notifications Edge Function</td>
            </tr>
            <tr>
                <td><code>trg_prevent_message_content_update</code></td>
                <td>messages</td>
                <td>Raise exception if message text is modified</td>
            </tr>
            <tr>
                <td><code>trg_set_message_sender</code></td>
                <td>messages</td>
                <td>Set sender_id, sender_type, is_user from auth.uid()</td>
            </tr>
        </table>

        <h3>DocSera Pro Only Triggers</h3>
        <table>
            <tr>
                <th>Trigger</th>
                <th>Table</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>trg_ensure_doctor_account_and_owner</code></td>
                <td>doctors</td>
                <td>Create doctor_account + owner membership on insert</td>
            </tr>
            <tr>
                <td><code>trg_set_doctor_public_token</code></td>
                <td>doctors</td>
                <td>Generate unique 8-char public token</td>
            </tr>
            <tr>
                <td><code>trg_default_message_reasons</code></td>
                <td>doctors</td>
                <td>Insert 6 default Arabic message reasons</td>
            </tr>
            <tr>
                <td><code>trg_default_accounting_labels</code></td>
                <td>doctors</td>
                <td>Copy default_accounting_labels to new doctor</td>
            </tr>
            <tr>
                <td><code>trg_create_default_report_templates</code></td>
                <td>doctors</td>
                <td>Copy default_report_templates to new doctor</td>
            </tr>
            <tr>
                <td><code>trg_assign_invoice_number</code></td>
                <td>accounting</td>
                <td>Auto-increment invoice_number per doctor</td>
            </tr>
            <tr>
                <td><code>trg_prevent_invoice_number_update</code></td>
                <td>accounting</td>
                <td>Raise exception if invoice_number changed</td>
            </tr>
            <tr>
                <td><code>trg_sync_is_billed_to_appointment</code></td>
                <td>accounting</td>
                <td>Sync is_billed flag to linked appointment</td>
            </tr>
            <tr>
                <td><code>trg_link_manual_patient</code></td>
                <td>doctor_patients</td>
                <td>Upsert to doctor_patient_links and doctor_account_patients</td>
            </tr>
            <tr>
                <td><code>trg_sync_doctor_patient_name</code></td>
                <td>doctor_patients</td>
                <td>Concatenate first_name + last_name to patient_name</td>
            </tr>
            <tr>
                <td><code>trg_set_doctor_id_on_doctor_members</code></td>
                <td>doctor_members</td>
                <td>Resolve doctor_id from doctor_account's primary doctor</td>
            </tr>
            <tr>
                <td><code>trg_reorder_after_delete</code></td>
                <td>message_reasons</td>
                <td>Decrement order_index for remaining items</td>
            </tr>
            <tr>
                <td><code>trg_prevent_doctor_id_change</code></td>
                <td>todo_tasks</td>
                <td>Raise exception if doctor_id modified</td>
            </tr>
        </table>

        <!-- 11. Security -->
        <h2>11. Security Features</h2>

        <div class="feature-grid">
            <div class="feature-card">
                <h4>üîê Biometric Auth</h4>
                <p>Face ID & Fingerprint via <code>local_auth</code></p>
            </div>
            <div class="feature-card">
                <h4>üîí Secure Storage</h4>
                <p>Encrypted via <code>flutter_secure_storage</code></p>
            </div>
            <div class="feature-card">
                <h4>üì± Phone OTP</h4>
                <p>Debug only (SMS provider pending)</p>
            </div>
            <div class="feature-card">
                <h4>üìß Email OTP</h4>
                <p>SHA256 hashed codes via <code>email_otps</code></p>
            </div>
            <div class="feature-card">
                <h4>üõ°Ô∏è Row Level Security</h4>
                <p>38/38 tables protected (130 policies)</p>
            </div>
            <div class="feature-card">
                <h4>‚ö° Security Definer</h4>
                <p>62 functions bypass RLS safely</p>
            </div>
        </div>

        <h3>RLS Policy Summary</h3>
        <table>
            <tr>
                <th>Category</th>
                <th>Count</th>
                <th>Status</th>
            </tr>
            <tr>
                <td>Tables with RLS Enabled</td>
                <td>38</td>
                <td class="status-enabled">‚úÖ Protected</td>
            </tr>
            <tr>
                <td>Tables without RLS (Pending)</td>
                <td>0</td>
                <td class="status-enabled">‚úÖ Complete</td>
            </tr>
            <tr>
                <td>Total RLS Policies</td>
                <td>130</td>
                <td>‚Äî</td>
            </tr>
            <tr>
                <td>Security Definer Functions</td>
                <td>62</td>
                <td class="status-enabled">‚úÖ Active</td>
            </tr>
        </table>

        <div class="page-break"></div>

        <!-- 12. Dependencies -->
        <h2>12. Package Dependencies</h2>

        <h3>Core & State Management</h3>
        <table>
            <tr>
                <th>Package</th>
                <th>Version</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>supabase_flutter</code></td>
                <td>^2.9.1</td>
                <td>Supabase SDK</td>
            </tr>
            <tr>
                <td><code>flutter_bloc</code></td>
                <td>^9.1.0</td>
                <td>BLoC state management</td>
            </tr>
            <tr>
                <td><code>shared_preferences</code></td>
                <td>^2.4.0</td>
                <td>Local key-value storage</td>
            </tr>
        </table>

        <h3>Authentication & Security</h3>
        <table>
            <tr>
                <th>Package</th>
                <th>Version</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>local_auth</code></td>
                <td>^2.3.0</td>
                <td>Biometric authentication</td>
            </tr>
            <tr>
                <td><code>flutter_secure_storage</code></td>
                <td>^9.2.4</td>
                <td>Encrypted storage</td>
            </tr>
            <tr>
                <td><code>crypto</code></td>
                <td>^3.0.0</td>
                <td>Cryptographic operations</td>
            </tr>
        </table>

        <h3>UI & Design</h3>
        <table>
            <tr>
                <th>Package</th>
                <th>Version</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>flutter_screenutil</code></td>
                <td>^5.9.3</td>
                <td>Responsive scaling</td>
            </tr>
            <tr>
                <td><code>flutter_svg</code></td>
                <td>^2.0.17</td>
                <td>SVG rendering</td>
            </tr>
            <tr>
                <td><code>shimmer</code></td>
                <td>^3.0.0</td>
                <td>Loading animations</td>
            </tr>
            <tr>
                <td><code>cached_network_image</code></td>
                <td>^3.4.1</td>
                <td>Image caching</td>
            </tr>
            <tr>
                <td><code>table_calendar</code></td>
                <td>^3.1.3</td>
                <td>Calendar widget</td>
            </tr>
            <tr>
                <td><code>confetti</code></td>
                <td>^0.8.0</td>
                <td>Celebration animations</td>
            </tr>
        </table>

        <h3>Documents & Media</h3>
        <table>
            <tr>
                <th>Package</th>
                <th>Version</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>flutter_quill</code></td>
                <td>^11.0.0</td>
                <td>Rich text editing</td>
            </tr>
            <tr>
                <td><code>file_picker</code></td>
                <td>^9.2.1</td>
                <td>File selection</td>
            </tr>
            <tr>
                <td><code>image_picker</code></td>
                <td>^1.1.2</td>
                <td>Photo selection</td>
            </tr>
            <tr>
                <td><code>record</code></td>
                <td>^6.1.2</td>
                <td>Voice recording</td>
            </tr>
            <tr>
                <td><code>audioplayers</code></td>
                <td>^6.5.1</td>
                <td>Audio playback</td>
            </tr>
        </table>

        <h3>Maps & Location</h3>
        <table>
            <tr>
                <th>Package</th>
                <th>Version</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>google_maps_flutter</code></td>
                <td>^2.12.3</td>
                <td>Google Maps</td>
            <tr>
                <td><code>geolocator</code></td>
                <td>^14.0.2</td>
                <td>User location</td>
            </tr>
        </table>

        <h3>Notifications & Communication</h3>
        <table>
            <tr>
                <th>Package</th>
                <th>Version</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>pushy_flutter</code></td>
                <td>^2.0.38</td>
                <td>Push notifications</td>
            </tr>
            <tr>
                <td><code>flutter_local_notifications</code></td>
                <td>^19.4.0</td>
                <td>Local notifications</td>
            </tr>
            <tr>
                <td><code>url_launcher</code></td>
                <td>^6.3.1</td>
                <td>External URLs</td>
            </tr>
        </table>

        <h3>Utilities</h3>
        <table>
            <tr>
                <th>Package</th>
                <th>Version</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>connectivity_plus</code></td>
                <td>^7.0.0</td>
                <td>Network status</td>
            </tr>
            <tr>
                <td><code>timezone</code></td>
                <td>^0.10.1</td>
                <td>Timezone handling</td>
            </tr>
            <tr>
                <td><code>app_links</code></td>
                <td>^6.4.0</td>
                <td>Deep linking</td>
            </tr>
            <tr>
                <td><code>path_provider</code></td>
                <td>^2.1.5</td>
                <td>File paths</td>
            </tr>
            <tr>
                <td><code>permission_handler</code></td>
                <td>^12.0.1</td>
                <td>OS permissions</td>
            </tr>
        </table>

        <!-- 13. Network -->
        <h2>13. Network Resilience</h2>
        <p>DocSera implements Syria-optimized networking for slow/unreliable connections:</p>

        <div class="info-box">
            <strong>Custom HTTP Client:</strong> All Supabase requests use a custom client with 30-second timeout to
            handle high-latency network conditions.
        </div>

        <table>
            <tr>
                <th>Feature</th>
                <th>Implementation</th>
            </tr>
            <tr>
                <td>Extended HTTP Timeouts</td>
                <td>30 seconds (vs default 10s)</td>
            </tr>
            <tr>
                <td>Offline Detection</td>
                <td>Banner displayed when offline</td>
            </tr>
            <tr>
                <td>Connectivity Monitoring</td>
                <td><code>connectivity_plus</code> stream</td>
            </tr>
            <tr>
                <td>Graceful Degradation</td>
                <td>Cached data shown when possible</td>
            </tr>
        </table>

        <!-- 14. Localization -->
        <h2>14. Localization</h2>

        <table>
            <tr>
                <th>Language</th>
                <th>Code</th>
                <th>Direction</th>
                <th>Font</th>
            </tr>
            <tr>
                <td>English</td>
                <td><code>en</code></td>
                <td>LTR</td>
                <td>Montserrat</td>
            </tr>
            <tr>
                <td>Arabic</td>
                <td><code>ar</code></td>
                <td>RTL</td>
                <td>Cairo</td>
            </tr>
        </table>

        <p>Full RTL support is implemented with automatic layout direction switching based on selected language.</p>

        <!-- 15. Platform -->
        <h2>15. Platform Support</h2>

        <table>
            <tr>
                <th>Platform</th>
                <th>Status</th>
                <th>Notes</th>
            </tr>
            <tr>
                <td><strong>iOS</strong></td>
                <td class="status-pending">üîß In Development</td>
                <td>Pre-release</td>
            </tr>
            <tr>
                <td><strong>Android</strong></td>
                <td class="status-pending">üîß In Development</td>
                <td>Pre-release</td>
            </tr>
        </table>

        <!-- Footer -->
        <div class="footer">
            <p><strong>DocSera Technology Stack Documentation</strong></p>
            <p>Version 1.0.0+14 ‚Ä¢ Generated: January 15, 2026</p>
            <p>Cross-referenced with Flutter codebase and live Supabase schema</p>
            <p style="margin-top: 10px; color: var(--primary);">¬© 2026 DocSera ‚Ä¢ Patient Application</p>
        </div>

    </div>
</body>

</html>