<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocSera - Technology Stack Documentation</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #009092;
            --primary-dark: #007577;
            --primary-light: #e6f5f5;
            --text: #1a1a2e;
            --text-light: #64748b;
            --bg: #ffffff;
            --border: #e2e8f0;
            --success: #10b981;
            --warning: #f59e0b;
            --code-bg: #f1f5f9;
            --diagram-bg: #f8fafc;
            --diagram-text: #1a1a2e;
            --diagram-border: #e2e8f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, sans-serif;
            color: var(--text);
            line-height: 1.6;
            background: var(--bg);
            font-size: 10pt;
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }

        @page {
            size: A4;
            margin: 15mm 12mm;
        }

        @media print {
            body {
                font-size: 9pt;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            .page-break {
                page-break-before: always;
            }

            .no-break {
                page-break-inside: avoid;
            }

            table {
                page-break-inside: avoid;
            }

            h2,
            h3 {
                page-break-after: avoid;
            }

            .diagram-container {
                background: var(--diagram-bg) !important;
                -webkit-print-color-adjust: exact !important;
            }
        }

        .container {
            max-width: 780px;
            margin: 0 auto;
            padding: 30px 25px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 35px 30px;
            border-radius: 16px;
            text-align: center;
            margin-bottom: 30px;
        }

        .header-logo {
            width: 70px;
            height: 70px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            font-size: 28px;
            font-weight: 700;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .header .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }

        .header-meta {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 18px;
            flex-wrap: wrap;
        }

        .badge {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 600;
        }

        /* Sections */
        h2 {
            font-size: 16px;
            font-weight: 700;
            color: var(--primary-dark);
            margin: 28px 0 14px;
            padding: 10px 0 8px;
            border-bottom: 2px solid var(--primary);
        }

        h3 {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            margin: 18px 0 10px;
            padding-left: 10px;
            border-left: 3px solid var(--primary);
        }

        p {
            margin-bottom: 12px;
            font-size: 10pt;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 12px 0 20px;
            font-size: 9pt;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        th {
            background: var(--primary);
            color: white;
            padding: 10px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        th:first-child {
            border-top-left-radius: 8px;
        }

        th:last-child {
            border-top-right-radius: 8px;
        }

        tr:last-child td:first-child {
            border-bottom-left-radius: 8px;
        }

        tr:last-child td:last-child {
            border-bottom-right-radius: 8px;
        }

        td {
            padding: 8px 12px;
            border-bottom: 1px solid var(--border);
            vertical-align: top;
        }

        tr:nth-child(even) {
            background: var(--code-bg);
        }

        code {
            background: var(--code-bg);
            padding: 1px 5px;
            border-radius: 3px;
            font-family: 'SF Mono', Monaco, Consolas, monospace;
            font-size: 9pt;
            color: var(--primary-dark);
        }

        .status-enabled {
            color: var(--success);
            font-weight: 600;
        }

        .status-pending {
            color: var(--warning);
            font-weight: 600;
        }

        /* Info boxes */
        .info-box {
            background: var(--primary-light);
            border-left: 4px solid var(--primary);
            padding: 12px 16px;
            border-radius: 0 8px 8px 0;
            margin: 16px 0;
            font-size: 9pt;
        }

        .info-box strong {
            color: var(--primary-dark);
        }

        .warning-box {
            background: #fef3c7;
            border-left: 4px solid var(--warning);
            padding: 12px 16px;
            border-radius: 0 8px 8px 0;
            margin: 16px 0;
            font-size: 9pt;
        }

        /* Diagram Container - Dark theme like reference */
        .diagram-container {
            background: var(--diagram-bg);
            border-radius: 12px;
            padding: 25px;
            margin: 16px 0;
            overflow: hidden;
        }

        .diagram-title {
            color: var(--diagram-text);
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        /* SVG Diagrams */
        .diagram-container svg {
            width: 100%;
            height: auto;
        }

        /* Feature Grid */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 16px 0;
        }

        .feature-card {
            background: var(--code-bg);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid var(--border);
        }

        .feature-card h4 {
            font-size: 10px;
            color: var(--primary-dark);
            margin-bottom: 4px;
        }

        .feature-card p {
            font-size: 8px;
            color: var(--text-light);
            margin: 0;
            line-height: 1.4;
        }

        /* TOC */
        .toc {
            background: var(--code-bg);
            border-radius: 10px;
            padding: 18px 22px;
            margin: 20px 0;
            column-count: 2;
            column-gap: 25px;
        }

        .toc-title {
            font-weight: 600;
            font-size: 11px;
            margin-bottom: 12px;
            color: var(--primary-dark);
            column-span: all;
        }

        .toc-item {
            padding: 4px 0;
            font-size: 9px;
            border-bottom: 1px dotted var(--border);
            break-inside: avoid;
        }

        /* Footer */
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid var(--border);
            text-align: center;
            color: var(--text-light);
            font-size: 9px;
        }
    </style>
</head>

<body>
    <div class="container">

        <!-- Header -->
        <div class="header no-break">
            <img src="docsera_logo.svg" alt="DocSera" style="height: 20px; margin-bottom: 8px;">
            <div class="subtitle">Technology Stack Documentation</div>
            <div class="header-meta">
                <span class="badge">Version 1.0.0+13</span>
                <span class="badge">Flutter 3.6+</span>
                <span class="badge">Supabase</span>
                <span class="badge">PostgreSQL 15</span>
                <span class="badge">iOS & Android</span>
            </div>
        </div>

        <!-- TOC -->
        <div class="toc no-break">
            <div class="toc-title">üìã Table of Contents</div>
            <div class="toc-item">1. Architecture Overview</div>
            <div class="toc-item">2. Frontend Stack</div>
            <div class="toc-item">3. Backend Infrastructure</div>
            <div class="toc-item">4. State Management</div>
            <div class="toc-item">5. Database Schema</div>
            <div class="toc-item">6. Entity Relationships</div>
            <div class="toc-item">7. Database Views</div>
            <div class="toc-item">8. RPC Functions</div>
            <div class="toc-item">9. Edge Functions</div>
            <div class="toc-item">10. Database Triggers</div>
            <div class="toc-item">11. Security Features</div>
            <div class="toc-item">12. Package Dependencies</div>
            <div class="toc-item">13. Network Resilience</div>
            <div class="toc-item">14. Localization</div>
            <div class="toc-item">15. Platform Support</div>
        </div>

        <!-- 1. Architecture Overview -->
        <h2>1. Architecture Overview</h2>

        <div class="diagram-container no-break">
            <svg viewBox="0 0 700 320" xmlns="http://www.w3.org/2000/svg">
                <!-- Styles -->
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#009092" />
                    </marker>
                </defs>

                <!-- Client Applications Group -->
                <rect x="150" y="20" width="400" height="60" rx="4" fill="none" stroke="#ccc" stroke-dasharray="5,3" />
                <text x="350" y="35" text-anchor="middle" fill="#666" font-size="10" font-family="Montserrat">Client
                    Applications</text>
                <rect x="170" y="45" width="140" height="28" rx="4" fill="#fff" stroke="#009092" />
                <text x="240" y="64" text-anchor="middle" fill="#007577" font-size="10" font-family="Montserrat">DocSera
                    Pro (Doctor App)</text>
                <rect x="390" y="45" width="140" height="28" rx="4" fill="#fff" stroke="#009092" />
                <text x="460" y="64" text-anchor="middle" fill="#007577" font-size="10" font-family="Montserrat">DocSera
                    (Patient App)</text>

                <!-- Arrow down -->
                <line x1="350" y1="85" x2="350" y2="105" stroke="#009092" stroke-width="2"
                    marker-end="url(#arrowhead)" />

                <!-- Supabase Backend Group -->
                <rect x="80" y="110" width="540" height="80" rx="4" fill="none" stroke="#ccc" stroke-dasharray="5,3" />
                <text x="350" y="125" text-anchor="middle" fill="#666" font-size="10" font-family="Montserrat">Supabase
                    Backend</text>
                <rect x="95" y="140" width="90" height="40" rx="4" fill="#fff" stroke="#009092" />
                <text x="140" y="165" text-anchor="middle" fill="#007577" font-size="9"
                    font-family="Montserrat">Authentication</text>
                <rect x="195" y="140" width="90" height="40" rx="4" fill="#fff" stroke="#009092" />
                <text x="240" y="165" text-anchor="middle" fill="#007577" font-size="9"
                    font-family="Montserrat">PostgreSQL
                    v15</text>
                <rect x="295" y="140" width="90" height="40" rx="4" fill="#fff" stroke="#009092" />
                <text x="340" y="165" text-anchor="middle" fill="#007577" font-size="9" font-family="Montserrat">File
                    Storage</text>
                <rect x="395" y="140" width="100" height="40" rx="4" fill="#fff" stroke="#009092" />
                <text x="445" y="165" text-anchor="middle" fill="#007577" font-size="9"
                    font-family="Montserrat">Realtime
                    Subs</text>
                <rect x="505" y="140" width="100" height="40" rx="4" fill="#fff" stroke="#009092" />
                <text x="555" y="165" text-anchor="middle" fill="#007577" font-size="9" font-family="Montserrat">Edge
                    Functions</text>

                <!-- Arrow down -->
                <line x1="350" y1="195" x2="350" y2="215" stroke="#009092" stroke-width="2"
                    marker-end="url(#arrowhead)" />

                <!-- External Services Group -->
                <rect x="150" y="220" width="400" height="70" rx="4" fill="none" stroke="#ccc" stroke-dasharray="5,3" />
                <text x="350" y="235" text-anchor="middle" fill="#666" font-size="10" font-family="Montserrat">External
                    Services</text>
                <rect x="200" y="250" width="130" height="30" rx="4" fill="#fff" stroke="#009092" />
                <text x="265" y="270" text-anchor="middle" fill="#007577" font-size="9" font-family="Montserrat">Pushy
                    Push
                    Notifications</text>
                <rect x="370" y="250" width="130" height="30" rx="4" fill="#fff" stroke="#009092" />
                <text x="435" y="270" text-anchor="middle" fill="#007577" font-size="9" font-family="Montserrat">Google
                    Maps / OSM</text>
            </svg>
        </div>

        <div class="info-box">
            <strong>NOTE:</strong> This documentation focuses on <strong>DocSera (Patient App)</strong>. The Supabase
            backend is shared with DocSera Pro (Doctor App).
        </div>

        <!-- 2. Frontend -->
        <h2>2. Frontend Stack</h2>

        <table>
            <tr>
                <th>Technology</th>
                <th>Version</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>Flutter</code></td>
                <td>SDK ‚â•3.6.0 &lt;4.0.0</td>
                <td>Cross-platform UI framework</td>
            </tr>
            <tr>
                <td><code>Dart</code></td>
                <td>Latest stable</td>
                <td>Programming language</td>
            </tr>
            <tr>
                <td><code>flutter_bloc</code></td>
                <td>^9.1.0</td>
                <td>State management (Cubit pattern)</td>
            </tr>
            <tr>
                <td><code>flutter_screenutil</code></td>
                <td>^5.9.3</td>
                <td>Responsive UI scaling</td>
            </tr>
        </table>

        <h3>Typography</h3>
        <table>
            <tr>
                <th>Font</th>
                <th>Language</th>
                <th>Direction</th>
                <th>Weights</th>
            </tr>
            <tr>
                <td><strong>Montserrat</strong></td>
                <td>English</td>
                <td>LTR</td>
                <td>300, 400, 500, 600, 700</td>
            </tr>
            <tr>
                <td><strong>Cairo</strong></td>
                <td>Arabic</td>
                <td>RTL</td>
                <td>100, 300, 400, 500, 600, 700, 900</td>
            </tr>
        </table>

        <!-- 3. Backend -->
        <h2>3. Backend Infrastructure</h2>

        <table>
            <tr>
                <th>Technology</th>
                <th>Details</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><strong>Supabase</strong></td>
                <td>Cloud-hosted</td>
                <td>Backend-as-a-Service platform</td>
            </tr>
            <tr>
                <td><strong>PostgreSQL</strong></td>
                <td>Version 15</td>
                <td>Primary relational database</td>
            </tr>
            <tr>
                <td><strong>Supabase Auth</strong></td>
                <td>Phone + Email OTP</td>
                <td>User authentication & sessions</td>
            </tr>
            <tr>
                <td><strong>Supabase Realtime</strong></td>
                <td>Built-in</td>
                <td>Live data subscriptions</td>
            </tr>
            <tr>
                <td><strong>Supabase Storage</strong></td>
                <td>chat.attachments, doctor</td>
                <td>File/document storage</td>
            </tr>
            <tr>
                <td><strong>Edge Functions</strong></td>
                <td>Deno/TypeScript</td>
                <td>Serverless functions</td>
            </tr>
        </table>

        <!-- 4. State Management -->
        <h2>4. State Management (BLoC Pattern)</h2>
        <p>DocSera implements the BLoC pattern using Cubits for predictable, testable state management.</p>

        <table>
            <tr>
                <th>Cubit</th>
                <th>Responsibility</th>
            </tr>
            <tr>
                <td><code>AuthCubit</code></td>
                <td>Authentication state, login/logout flows</td>
            </tr>
            <tr>
                <td><code>MainScreenCubit</code></td>
                <td>Home screen data loading</td>
            </tr>
            <tr>
                <td><code>AppointmentsCubit</code></td>
                <td>Appointment management</td>
            </tr>
            <tr>
                <td><code>MessagesCubit</code></td>
                <td>Conversations and messaging</td>
            </tr>
            <tr>
                <td><code>DocumentsCubit</code></td>
                <td>Medical document management</td>
            </tr>
            <tr>
                <td><code>NotesCubit</code></td>
                <td>Patient notes handling</td>
            </tr>
            <tr>
                <td><code>UserCubit</code></td>
                <td>User profile and preferences</td>
            </tr>
            <tr>
                <td><code>PatientSwitcherCubit</code></td>
                <td>Multi-patient (relatives) switching</td>
            </tr>
            <tr>
                <td><code>RelativesCubit</code></td>
                <td>Family member management</td>
            </tr>
            <tr>
                <td><code>DoctorScheduleCubit</code></td>
                <td>Doctor availability management</td>
            </tr>
            <tr>
                <td><code>PopupBannerCubit</code></td>
                <td>In-app announcements and updates</td>
            </tr>
            <tr>
                <td><code>AccountProfileCubit</code></td>
                <td>Profile settings</td>
            </tr>
            <tr>
                <td><code>AccountSecurityCubit</code></td>
                <td>Security settings (2FA, biometrics)</td>
            </tr>
            <tr>
                <td><code>AccountDangerCubit</code></td>
                <td>Account deletion/deactivation</td>
            </tr>
        </table>

        <div class="page-break"></div>

        <!-- 5. Database Schema -->
        <h2>5. Database Schema</h2>

        <h3>Tables Used by DocSera Patient App (20 tables)</h3>
        <table>
            <tr>
                <th>Table</th>
                <th>Purpose</th>
                <th>RLS Status</th>
            </tr>
            <tr>
                <td><code>users</code></td>
                <td>Patient profiles</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>doctors</code></td>
                <td>Doctor public profiles</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>appointments</code></td>
                <td>Appointment bookings</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>appointment_reasons</code></td>
                <td>Booking reasons</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>reason_time_slots</code></td>
                <td>Reason-specific time slots</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>conversations</code></td>
                <td>Chat threads</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>messages</code></td>
                <td>Chat messages</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>message_reasons</code></td>
                <td>Conversation topics</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>doctor_patient_blocks</code></td>
                <td>Message blocking</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>documents</code></td>
                <td>Medical documents</td>
                <td class="status-pending">‚ö†Ô∏è Pending</td>
            </tr>
            <tr>
                <td><code>notes</code></td>
                <td>Patient notes</td>
                <td class="status-pending">‚ö†Ô∏è Pending</td>
            </tr>
            <tr>
                <td><code>relatives</code></td>
                <td>Family members</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>banners</code></td>
                <td>Home page banners</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>home_cards</code></td>
                <td>Home action cards</td>
                <td class="status-pending">‚ö†Ô∏è Pending</td>
            </tr>
            <tr>
                <td><code>popup_banners</code></td>
                <td>In-app popups</td>
                <td class="status-pending">‚ö†Ô∏è Pending</td>
            </tr>
            <tr>
                <td><code>user_devices</code></td>
                <td>Push notification tokens</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>doctor_vacations</code></td>
                <td>Doctor unavailability</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>email_otps</code></td>
                <td>Email OTP codes (hashed)</td>
                <td class="status-pending">‚ö†Ô∏è Pending</td>
            </tr>
            <tr>
                <td><code>otp_rate_limits</code></td>
                <td>OTP rate limiting (IP-based)</td>
                <td class="status-pending">‚ö†Ô∏è Pending</td>
            </tr>
            <tr>
                <td><code>otp</code></td>
                <td>Phone OTP codes (debug only)</td>
                <td class="status-pending">‚ö†Ô∏è Debug</td>
            </tr>
        </table>

        <div class="info-box">
            <strong>üì± Phone OTP Note:</strong> The <code>otp</code> table stores plain-text OTP codes for local
            debugging.
            A third-party SMS provider will replace this before production release.
        </div>

        <h3>Tables Used by DocSera Pro Only (15 tables)</h3>
        <table>
            <tr>
                <th>Table</th>
                <th>Purpose</th>
                <th>RLS Status</th>
            </tr>
            <tr>
                <td><code>doctor_accounts</code></td>
                <td>Clinic accounts</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>doctor_members</code></td>
                <td>Team members</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>team_profiles</code></td>
                <td>Staff profiles</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>doctor_patients</code></td>
                <td>Manual patients</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>doctor_patient_links</code></td>
                <td>Patient relationships</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>doctor_account_patients</code></td>
                <td>Account-level patient tracking</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>accounting</code></td>
                <td>Financial records</td>
                <td class="status-pending">‚ö†Ô∏è Pending</td>
            </tr>
            <tr>
                <td><code>accounting_labels</code></td>
                <td>Expense categories</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>default_accounting_labels</code></td>
                <td>System default expense labels</td>
                <td class="status-pending">‚ö†Ô∏è Pending</td>
            </tr>
            <tr>
                <td><code>doctor_reports</code></td>
                <td>Generated visit reports</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>doctor_report_templates</code></td>
                <td>Custom report templates</td>
                <td class="status-pending">‚ö†Ô∏è Pending</td>
            </tr>
            <tr>
                <td><code>default_report_templates</code></td>
                <td>System default report templates</td>
                <td class="status-pending">‚ö†Ô∏è Pending</td>
            </tr>
            <tr>
                <td><code>todo_tasks</code></td>
                <td>Doctor to-do list</td>
                <td class="status-enabled">‚úÖ Enabled</td>
            </tr>
            <tr>
                <td><code>medical_master</code></td>
                <td>Medical conditions catalog</td>
                <td class="status-pending">‚ö†Ô∏è Pending</td>
            </tr>
            <tr>
                <td><code>patient_medical_records</code></td>
                <td>Health records</td>
                <td class="status-pending">‚ö†Ô∏è Pending</td>
            </tr>
        </table>

        <div class="warning-box">
            <strong>‚ö†Ô∏è Security Note:</strong> Tables marked "Pending" will have Row Level Security policies added
            before production release.
        </div>

        <!-- 6. Entity Relationships -->
        <h2>6. Entity Relationships</h2>

        <div class="diagram-container no-break">
            <div class="diagram-title">Entity Relationships</div>
            <svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <marker id="dot2" markerWidth="8" markerHeight="8" refX="4" refY="4" orient="auto">
                        <circle cx="4" cy="4" r="3" fill="#009092" />
                    </marker>
                </defs>

                <!-- Section Labels -->
                <text x="120" y="20" fill="#009092" font-size="11" font-family="Montserrat" font-weight="600">Patient
                    App</text>
                <text x="350" y="20" fill="#009092" font-size="11" font-family="Montserrat" font-weight="600">Shared
                    Core</text>
                <text x="620" y="20" fill="#009092" font-size="11" font-family="Montserrat" font-weight="600">DocSera
                    Pro</text>

                <!-- ===== USERS (Center Top) ===== -->
                <rect x="320" y="40" width="100" height="40" rx="4" fill="#e6f7f7" stroke="#009092" stroke-width="2" />
                <text x="370" y="65" text-anchor="middle" fill="#007577" font-size="11" font-family="Montserrat"
                    font-weight="600">users</text>

                <!-- ===== PATIENT APP ENTITIES (Left Side) ===== -->

                <!-- relatives -->
                <rect x="40" y="100" width="90" height="35" rx="4" fill="#fff" stroke="#009092" />
                <text x="85" y="122" text-anchor="middle" fill="#007577" font-size="10"
                    font-family="Montserrat">relatives</text>

                <!-- documents -->
                <rect x="145" y="100" width="90" height="35" rx="4" fill="#fff" stroke="#009092" />
                <text x="190" y="122" text-anchor="middle" fill="#007577" font-size="10"
                    font-family="Montserrat">documents</text>

                <!-- notes -->
                <rect x="40" y="160" width="90" height="35" rx="4" fill="#fff" stroke="#009092" />
                <text x="85" y="182" text-anchor="middle" fill="#007577" font-size="10"
                    font-family="Montserrat">notes</text>

                <!-- user_devices -->
                <rect x="145" y="160" width="90" height="35" rx="4" fill="#fff" stroke="#009092" />
                <text x="190" y="182" text-anchor="middle" fill="#007577" font-size="10"
                    font-family="Montserrat">user_devices</text>

                <!-- ===== SHARED CORE ENTITIES (Center) ===== -->

                <!-- doctors -->
                <rect x="320" y="110" width="100" height="40" rx="4" fill="#e6f7f7" stroke="#009092" stroke-width="2" />
                <text x="370" y="135" text-anchor="middle" fill="#007577" font-size="11" font-family="Montserrat"
                    font-weight="600">doctors</text>

                <!-- appointments -->
                <rect x="270" y="190" width="100" height="35" rx="4" fill="#fff" stroke="#009092" />
                <text x="320" y="212" text-anchor="middle" fill="#007577" font-size="10"
                    font-family="Montserrat">appointments</text>

                <!-- appointment_reasons -->
                <rect x="270" y="250" width="120" height="35" rx="4" fill="#fff" stroke="#009092" />
                <text x="330" y="272" text-anchor="middle" fill="#007577" font-size="9"
                    font-family="Montserrat">appointment_reasons</text>

                <!-- conversations -->
                <rect x="400" y="190" width="100" height="35" rx="4" fill="#fff" stroke="#009092" />
                <text x="450" y="212" text-anchor="middle" fill="#007577" font-size="10"
                    font-family="Montserrat">conversations</text>

                <!-- messages -->
                <rect x="400" y="250" width="90" height="35" rx="4" fill="#fff" stroke="#009092" />
                <text x="445" y="272" text-anchor="middle" fill="#007577" font-size="10"
                    font-family="Montserrat">messages</text>

                <!-- doctor_vacations -->
                <rect x="280" y="310" width="110" height="35" rx="4" fill="#fff" stroke="#009092" />
                <text x="335" y="332" text-anchor="middle" fill="#007577" font-size="9"
                    font-family="Montserrat">doctor_vacations</text>

                <!-- ===== PRO APP ENTITIES (Right Side) ===== -->

                <!-- doctor_accounts -->
                <rect x="560" y="70" width="120" height="40" rx="4" fill="#e6f7f7" stroke="#009092" stroke-width="2" />
                <text x="620" y="95" text-anchor="middle" fill="#007577" font-size="10" font-family="Montserrat"
                    font-weight="600">doctor_accounts</text>

                <!-- doctor_members -->
                <rect x="560" y="130" width="110" height="35" rx="4" fill="#fff" stroke="#009092" />
                <text x="615" y="152" text-anchor="middle" fill="#007577" font-size="9"
                    font-family="Montserrat">doctor_members</text>

                <!-- team_profiles -->
                <rect x="680" y="130" width="100" height="35" rx="4" fill="#fff" stroke="#009092" />
                <text x="730" y="152" text-anchor="middle" fill="#007577" font-size="9"
                    font-family="Montserrat">team_profiles</text>

                <!-- doctor_account_patients -->
                <rect x="540" y="190" width="145" height="35" rx="4" fill="#fff" stroke="#009092" />
                <text x="612" y="212" text-anchor="middle" fill="#007577" font-size="8"
                    font-family="Montserrat">doctor_account_patients</text>

                <!-- doctor_patients -->
                <rect x="700" y="190" width="100" height="35" rx="4" fill="#fff" stroke="#009092" />
                <text x="750" y="212" text-anchor="middle" fill="#007577" font-size="9"
                    font-family="Montserrat">doctor_patients</text>

                <!-- accounting -->
                <rect x="560" y="250" width="90" height="35" rx="4" fill="#fff" stroke="#009092" />
                <text x="605" y="272" text-anchor="middle" fill="#007577" font-size="10"
                    font-family="Montserrat">accounting</text>

                <!-- accounting_labels -->
                <rect x="660" y="250" width="110" height="35" rx="4" fill="#fff" stroke="#009092" />
                <text x="715" y="272" text-anchor="middle" fill="#007577" font-size="9"
                    font-family="Montserrat">accounting_labels</text>

                <!-- todo_tasks -->
                <rect x="560" y="310" width="90" height="35" rx="4" fill="#fff" stroke="#009092" />
                <text x="605" y="332" text-anchor="middle" fill="#007577" font-size="10"
                    font-family="Montserrat">todo_tasks</text>

                <!-- message_reasons -->
                <rect x="660" y="310" width="110" height="35" rx="4" fill="#fff" stroke="#009092" />
                <text x="715" y="332" text-anchor="middle" fill="#007577" font-size="9"
                    font-family="Montserrat">message_reasons</text>

                <!-- ===== RELATIONSHIP LINES ===== -->

                <!-- users -> relatives -->
                <line x1="320" y1="60" x2="130" y2="100" stroke="#009092" stroke-width="1.5" />
                <circle cx="320" cy="60" r="4" fill="#009092" />
                <text x="200" y="70" fill="#666" font-size="8" font-family="Montserrat">manages</text>

                <!-- users -> documents -->
                <line x1="340" y1="80" x2="235" y2="100" stroke="#009092" stroke-width="1.5" />

                <!-- users -> notes -->
                <line x1="320" y1="80" x2="130" y2="160" stroke="#009092" stroke-width="1.5" />

                <!-- users -> user_devices -->
                <line x1="350" y1="80" x2="190" y2="160" stroke="#009092" stroke-width="1.5" />

                <!-- users -> doctors (can be) -->
                <line x1="370" y1="80" x2="370" y2="110" stroke="#009092" stroke-width="1.5" />
                <circle cx="370" cy="80" r="4" fill="#009092" />

                <!-- doctors -> appointments -->
                <line x1="345" y1="150" x2="320" y2="190" stroke="#009092" stroke-width="1.5" />
                <circle cx="345" cy="150" r="4" fill="#009092" />

                <!-- doctors -> conversations -->
                <line x1="395" y1="150" x2="450" y2="190" stroke="#009092" stroke-width="1.5" />

                <!-- doctors -> doctor_vacations -->
                <line x1="370" y1="150" x2="335" y2="310" stroke="#009092" stroke-width="1.5" />

                <!-- appointments -> appointment_reasons -->
                <line x1="320" y1="225" x2="330" y2="250" stroke="#009092" stroke-width="1.5" />
                <circle cx="320" cy="225" r="4" fill="#009092" />

                <!-- conversations -> messages -->
                <line x1="445" y1="225" x2="445" y2="250" stroke="#009092" stroke-width="1.5" />
                <circle cx="445" cy="225" r="4" fill="#009092" />

                <!-- doctor_accounts -> doctor_members -->
                <line x1="620" y1="110" x2="615" y2="130" stroke="#009092" stroke-width="1.5" />
                <circle cx="620" cy="110" r="4" fill="#009092" />

                <!-- doctor_members -> team_profiles -->
                <line x1="670" y1="147" x2="680" y2="147" stroke="#009092" stroke-width="1.5" />

                <!-- doctor_accounts -> doctor_account_patients -->
                <line x1="620" y1="110" x2="612" y2="190" stroke="#009092" stroke-width="1.5" />

                <!-- doctor_accounts -> accounting -->
                <line x1="590" y1="110" x2="605" y2="250" stroke="#009092" stroke-width="1.5" />

                <!-- doctor_accounts -> todo_tasks -->
                <line x1="600" y1="110" x2="605" y2="310" stroke="#009092" stroke-width="1.5" />

                <!-- doctor_accounts -> message_reasons -->
                <line x1="650" y1="110" x2="715" y2="310" stroke="#009092" stroke-width="1.5" />

                <!-- accounting -> accounting_labels -->
                <line x1="650" y1="267" x2="660" y2="267" stroke="#009092" stroke-width="1.5" />

                <!-- Legend -->
                <rect x="40" y="530" width="15" height="15" rx="2" fill="#e6f7f7" stroke="#009092" stroke-width="2" />
                <text x="60" y="542" fill="#666" font-size="9" font-family="Montserrat">Primary Entity</text>

                <rect x="160" y="530" width="15" height="15" rx="2" fill="#fff" stroke="#009092" />
                <text x="180" y="542" fill="#666" font-size="9" font-family="Montserrat">Related Entity</text>

                <line x1="290" y1="538" x2="330" y2="538" stroke="#009092" stroke-width="1.5" />
                <circle cx="290" cy="538" r="4" fill="#009092" />
                <text x="340" y="542" fill="#666" font-size="9" font-family="Montserrat">Foreign Key</text>
            </svg>
        </div>

        <h3>Key Foreign Key Relationships</h3>
        <table>
            <tr>
                <th>From Table</th>
                <th>Column</th>
                <th>References</th>
                <th>Cardinality</th>
            </tr>
            <tr>
                <td>appointments</td>
                <td>user_id</td>
                <td>users.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>appointments</td>
                <td>doctor_id</td>
                <td>doctors.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>appointments</td>
                <td>relative_id</td>
                <td>relatives.id</td>
                <td>many-to-one (nullable)</td>
            </tr>
            <tr>
                <td>appointments</td>
                <td>reason_id</td>
                <td>appointment_reasons.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>conversations</td>
                <td>patient_id</td>
                <td>users.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>conversations</td>
                <td>doctor_id</td>
                <td>doctors.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>messages</td>
                <td>conversation_id</td>
                <td>conversations.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>relatives</td>
                <td>user_id</td>
                <td>users.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>documents</td>
                <td>user_id</td>
                <td>users.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>notes</td>
                <td>user_id</td>
                <td>users.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>user_devices</td>
                <td>user_id</td>
                <td>users.id</td>
                <td>many-to-one</td>
            </tr>
            <tr>
                <td>doctor_vacations</td>
                <td>doctor_id</td>
                <td>doctors.id</td>
                <td>many-to-one</td>
            </tr>
        </table>

        <div class="page-break"></div>

        <!-- 7. Views -->
        <h2>7. Database Views</h2>

        <table>
            <tr>
                <th>View</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>v_my_membership</code></td>
                <td>Current user's doctor membership & role</td>
            </tr>
            <tr>
                <td><code>v_team_members</code></td>
                <td>Team members with profile data joined</td>
            </tr>
            <tr>
                <td><code>v_doctor_members_safe</code></td>
                <td>Safe member listing without sensitive data</td>
            </tr>
            <tr>
                <td><code>v_doctor_patients_full</code></td>
                <td>Unified patient view (user/relative/manual)</td>
            </tr>
            <tr>
                <td><code>v_clinic_patients_searchable</code></td>
                <td>Searchable patient list for clinics</td>
            </tr>
        </table>

        <!-- 8. RPC Functions -->
        <h2>8. RPC Functions Used by DocSera</h2>

        <h3>Appointment Management</h3>
        <table>
            <tr>
                <th>Function</th>
                <th>Purpose</th>
                <th>Security</th>
            </tr>
            <tr>
                <td><code>book_appointment_by_patient</code></td>
                <td>Book new appointment with doctor</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>cancel_appointment_by_patient</code></td>
                <td>Cancel existing appointment</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>get_available_slots</code></td>
                <td>Get doctor's available time slots</td>
                <td>INVOKER</td>
            </tr>
            <tr>
                <td><code>add_appointment_attachment</code></td>
                <td>Add files to appointment</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>remove_appointment_attachment</code></td>
                <td>Remove appointment files</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>reschedule_appointment_by_patient</code></td>
                <td>Reschedule existing appointment</td>
                <td>DEFINER</td>
            </tr>
        </table>

        <h3>User Profile Management</h3>
        <table>
            <tr>
                <th>Function</th>
                <th>Purpose</th>
                <th>Security</th>
            </tr>
            <tr>
                <td><code>rpc_get_my_user</code></td>
                <td>Get current user profile</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>rpc_update_my_user</code></td>
                <td>Update user profile</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>rpc_get_my_security_state</code></td>
                <td>Get security settings</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>rpc_get_my_patient_context</code></td>
                <td>Get patient booking context</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>rpc_deactivate_my_account</code></td>
                <td>Deactivate user account</td>
                <td>DEFINER</td>
            </tr>
        </table>

        <h3>Relatives Management</h3>
        <table>
            <tr>
                <th>Function</th>
                <th>Purpose</th>
                <th>Security</th>
            </tr>
            <tr>
                <td><code>rpc_get_my_relatives</code></td>
                <td>List family members</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>rpc_add_my_relative</code></td>
                <td>Add family member</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>rpc_update_my_relative</code></td>
                <td>Update family member</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>rpc_deactivate_my_relative</code></td>
                <td>Soft delete family member</td>
                <td>DEFINER</td>
            </tr>
        </table>

        <h3>Favorites & Messaging</h3>
        <table>
            <tr>
                <th>Function</th>
                <th>Purpose</th>
                <th>Security</th>
            </tr>
            <tr>
                <td><code>rpc_get_my_favorite_doctors</code></td>
                <td>Get saved/favorite doctors</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>toggle_favorite_doctor</code></td>
                <td>Save or unsave a doctor</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>rpc_mark_messages_read</code></td>
                <td>Mark messages as read</td>
                <td>DEFINER</td>
            </tr>
        </table>

        <h3>Authentication</h3>
        <table>
            <tr>
                <th>Function</th>
                <th>Purpose</th>
                <th>Security</th>
            </tr>
            <tr>
                <td><code>phone_exists</code></td>
                <td>Check if phone is registered</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>email_exists</code></td>
                <td>Check if email is registered</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>send_login_otp</code></td>
                <td>Request login OTP code</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>verify_login_otp</code></td>
                <td>Verify OTP code</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>trust_current_device</code></td>
                <td>Mark device as trusted</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>rpc_get_login_info</code></td>
                <td>Get login info by identifier</td>
                <td>DEFINER</td>
            </tr>
            <tr>
                <td><code>rpc_verify_email_otp</code></td>
                <td>Verify email OTP (hashed)</td>
                <td>DEFINER</td>
            </tr>
        </table>

        <!-- 9. Edge Functions -->
        <h2>9. Edge Functions</h2>

        <table>
            <tr>
                <th>Function</th>
                <th>Purpose</th>
                <th>Authentication</th>
            </tr>
            <tr>
                <td><code>send_email_otp</code></td>
                <td>Generate OTP via rpc_create_email_otp, send via SMTP</td>
                <td>Public (no JWT)</td>
            </tr>
            <tr>
                <td><code>push_notifications</code></td>
                <td>Handle messages/appointments/documents notifications via Pushy</td>
                <td>Service Role (webhook)</td>
            </tr>
            <tr>
                <td><code>update_email_admin</code></td>
                <td>Update email in auth.users + sync to public.users</td>
                <td>JWT Required</td>
            </tr>
        </table>

        <!-- 10. Triggers -->
        <h2>10. Database Triggers</h2>

        <h3>Shared Triggers (Both Apps)</h3>
        <table>
            <tr>
                <th>Trigger</th>
                <th>Table</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>trg_sync_appointment_local_fields</code></td>
                <td>appointments</td>
                <td>Convert UTC timestamp to local date/time (GMT+3)</td>
            </tr>
            <tr>
                <td><code>trg_prevent_double_booking</code></td>
                <td>appointments</td>
                <td>Raise exception if slot already booked</td>
            </tr>
            <tr>
                <td><code>trg_set_appointment_defaults</code></td>
                <td>appointments</td>
                <td>Set duration and end_time from doctor settings</td>
            </tr>
            <tr>
                <td><code>trg_set_appointment_doctor_account_id</code></td>
                <td>appointments</td>
                <td>Auto-fill doctor_account_id from doctors table</td>
            </tr>
            <tr>
                <td><code>trg_upsert_patient_links_from_appointments</code></td>
                <td>appointments</td>
                <td>Upsert to doctor_patient_links and doctor_account_patients</td>
            </tr>
            <tr>
                <td><code>appointment-updates</code></td>
                <td>appointments</td>
                <td>HTTP call to push_notifications Edge Function</td>
            </tr>
            <tr>
                <td><code>on_new_message</code></td>
                <td>messages</td>
                <td>Update conversation last_message, unread counts</td>
            </tr>
            <tr>
                <td><code>push_messages</code></td>
                <td>messages</td>
                <td>HTTP call to push_notifications Edge Function</td>
            </tr>
            <tr>
                <td><code>trg_prevent_message_content_update</code></td>
                <td>messages</td>
                <td>Raise exception if message text is modified</td>
            </tr>
            <tr>
                <td><code>trg_set_message_sender</code></td>
                <td>messages</td>
                <td>Set sender_id, sender_type, is_user from auth.uid()</td>
            </tr>
        </table>

        <h3>DocSera Pro Only Triggers</h3>
        <table>
            <tr>
                <th>Trigger</th>
                <th>Table</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>trg_ensure_doctor_account_and_owner</code></td>
                <td>doctors</td>
                <td>Create doctor_account + owner membership on insert</td>
            </tr>
            <tr>
                <td><code>trg_set_doctor_public_token</code></td>
                <td>doctors</td>
                <td>Generate unique 8-char public token</td>
            </tr>
            <tr>
                <td><code>trg_default_message_reasons</code></td>
                <td>doctors</td>
                <td>Insert 6 default Arabic message reasons</td>
            </tr>
            <tr>
                <td><code>trg_default_accounting_labels</code></td>
                <td>doctors</td>
                <td>Copy default_accounting_labels to new doctor</td>
            </tr>
            <tr>
                <td><code>trg_create_default_report_templates</code></td>
                <td>doctors</td>
                <td>Copy default_report_templates to new doctor</td>
            </tr>
            <tr>
                <td><code>trg_assign_invoice_number</code></td>
                <td>accounting</td>
                <td>Auto-increment invoice_number per doctor</td>
            </tr>
            <tr>
                <td><code>trg_prevent_invoice_number_update</code></td>
                <td>accounting</td>
                <td>Raise exception if invoice_number changed</td>
            </tr>
            <tr>
                <td><code>trg_sync_is_billed_to_appointment</code></td>
                <td>accounting</td>
                <td>Sync is_billed flag to linked appointment</td>
            </tr>
            <tr>
                <td><code>trg_link_manual_patient</code></td>
                <td>doctor_patients</td>
                <td>Upsert to doctor_patient_links and doctor_account_patients</td>
            </tr>
            <tr>
                <td><code>trg_sync_doctor_patient_name</code></td>
                <td>doctor_patients</td>
                <td>Concatenate first_name + last_name to patient_name</td>
            </tr>
            <tr>
                <td><code>trg_set_doctor_id_on_doctor_members</code></td>
                <td>doctor_members</td>
                <td>Resolve doctor_id from doctor_account's primary doctor</td>
            </tr>
            <tr>
                <td><code>trg_reorder_after_delete</code></td>
                <td>message_reasons</td>
                <td>Decrement order_index for remaining items</td>
            </tr>
            <tr>
                <td><code>trg_prevent_doctor_id_change</code></td>
                <td>todo_tasks</td>
                <td>Raise exception if doctor_id modified</td>
            </tr>
        </table>

        <!-- 11. Security -->
        <h2>11. Security Features</h2>

        <div class="feature-grid">
            <div class="feature-card">
                <h4>üîê Biometric Auth</h4>
                <p>Face ID & Fingerprint via <code>local_auth</code></p>
            </div>
            <div class="feature-card">
                <h4>üîí Secure Storage</h4>
                <p>Encrypted via <code>flutter_secure_storage</code></p>
            </div>
            <div class="feature-card">
                <h4>üì± Phone OTP</h4>
                <p>Debug only (SMS provider pending)</p>
            </div>
            <div class="feature-card">
                <h4>üìß Email OTP</h4>
                <p>SHA256 hashed codes via <code>email_otps</code></p>
            </div>
            <div class="feature-card">
                <h4>üõ°Ô∏è Row Level Security</h4>
                <p>24/38 tables protected (90 policies)</p>
            </div>
            <div class="feature-card">
                <h4>‚ö° Security Definer</h4>
                <p>55 functions bypass RLS safely</p>
            </div>
        </div>

        <h3>RLS Policy Summary</h3>
        <table>
            <tr>
                <th>Category</th>
                <th>Count</th>
                <th>Status</th>
            </tr>
            <tr>
                <td>Tables with RLS Enabled</td>
                <td>24</td>
                <td class="status-enabled">‚úÖ Protected</td>
            </tr>
            <tr>
                <td>Tables without RLS (Pending)</td>
                <td>14</td>
                <td class="status-pending">‚ö†Ô∏è In Progress</td>
            </tr>
            <tr>
                <td>Total RLS Policies</td>
                <td>90</td>
                <td>‚Äî</td>
            </tr>
            <tr>
                <td>Security Definer Functions</td>
                <td>55</td>
                <td class="status-enabled">‚úÖ Active</td>
            </tr>
        </table>

        <div class="page-break"></div>

        <!-- 12. Dependencies -->
        <h2>12. Package Dependencies</h2>

        <h3>Core & State Management</h3>
        <table>
            <tr>
                <th>Package</th>
                <th>Version</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>supabase_flutter</code></td>
                <td>^2.9.1</td>
                <td>Supabase SDK</td>
            </tr>
            <tr>
                <td><code>flutter_bloc</code></td>
                <td>^9.1.0</td>
                <td>BLoC state management</td>
            </tr>
            <tr>
                <td><code>shared_preferences</code></td>
                <td>^2.4.0</td>
                <td>Local key-value storage</td>
            </tr>
        </table>

        <h3>Authentication & Security</h3>
        <table>
            <tr>
                <th>Package</th>
                <th>Version</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>local_auth</code></td>
                <td>^2.3.0</td>
                <td>Biometric authentication</td>
            </tr>
            <tr>
                <td><code>flutter_secure_storage</code></td>
                <td>^9.2.4</td>
                <td>Encrypted storage</td>
            </tr>
            <tr>
                <td><code>crypto</code></td>
                <td>^3.0.0</td>
                <td>Cryptographic operations</td>
            </tr>
        </table>

        <h3>UI & Design</h3>
        <table>
            <tr>
                <th>Package</th>
                <th>Version</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>flutter_screenutil</code></td>
                <td>^5.9.3</td>
                <td>Responsive scaling</td>
            </tr>
            <tr>
                <td><code>flutter_svg</code></td>
                <td>^2.0.17</td>
                <td>SVG rendering</td>
            </tr>
            <tr>
                <td><code>shimmer</code></td>
                <td>^3.0.0</td>
                <td>Loading animations</td>
            </tr>
            <tr>
                <td><code>cached_network_image</code></td>
                <td>^3.4.1</td>
                <td>Image caching</td>
            </tr>
            <tr>
                <td><code>table_calendar</code></td>
                <td>^3.1.3</td>
                <td>Calendar widget</td>
            </tr>
            <tr>
                <td><code>confetti</code></td>
                <td>^0.8.0</td>
                <td>Celebration animations</td>
            </tr>
        </table>

        <h3>Documents & Media</h3>
        <table>
            <tr>
                <th>Package</th>
                <th>Version</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>flutter_quill</code></td>
                <td>^11.0.0</td>
                <td>Rich text editing</td>
            </tr>
            <tr>
                <td><code>file_picker</code></td>
                <td>^9.2.1</td>
                <td>File selection</td>
            </tr>
            <tr>
                <td><code>image_picker</code></td>
                <td>^1.1.2</td>
                <td>Photo selection</td>
            </tr>
            <tr>
                <td><code>record</code></td>
                <td>^6.1.2</td>
                <td>Voice recording</td>
            </tr>
            <tr>
                <td><code>audioplayers</code></td>
                <td>^6.5.1</td>
                <td>Audio playback</td>
            </tr>
        </table>

        <h3>Maps & Location</h3>
        <table>
            <tr>
                <th>Package</th>
                <th>Version</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>google_maps_flutter</code></td>
                <td>^2.12.3</td>
                <td>Google Maps</td>
            <tr>
                <td><code>geolocator</code></td>
                <td>^14.0.2</td>
                <td>User location</td>
            </tr>
        </table>

        <h3>Notifications & Communication</h3>
        <table>
            <tr>
                <th>Package</th>
                <th>Version</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>pushy_flutter</code></td>
                <td>^2.0.38</td>
                <td>Push notifications</td>
            </tr>
            <tr>
                <td><code>flutter_local_notifications</code></td>
                <td>^19.4.0</td>
                <td>Local notifications</td>
            </tr>
            <tr>
                <td><code>url_launcher</code></td>
                <td>^6.3.1</td>
                <td>External URLs</td>
            </tr>
        </table>

        <h3>Utilities</h3>
        <table>
            <tr>
                <th>Package</th>
                <th>Version</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>connectivity_plus</code></td>
                <td>^7.0.0</td>
                <td>Network status</td>
            </tr>
            <tr>
                <td><code>timezone</code></td>
                <td>^0.10.1</td>
                <td>Timezone handling</td>
            </tr>
            <tr>
                <td><code>app_links</code></td>
                <td>^6.4.0</td>
                <td>Deep linking</td>
            </tr>
            <tr>
                <td><code>path_provider</code></td>
                <td>^2.1.5</td>
                <td>File paths</td>
            </tr>
            <tr>
                <td><code>permission_handler</code></td>
                <td>^12.0.1</td>
                <td>OS permissions</td>
            </tr>
        </table>

        <!-- 13. Network -->
        <h2>13. Network Resilience</h2>
        <p>DocSera implements Syria-optimized networking for slow/unreliable connections:</p>

        <div class="info-box">
            <strong>Custom HTTP Client:</strong> All Supabase requests use a custom client with 30-second timeout to
            handle high-latency network conditions.
        </div>

        <table>
            <tr>
                <th>Feature</th>
                <th>Implementation</th>
            </tr>
            <tr>
                <td>Extended HTTP Timeouts</td>
                <td>30 seconds (vs default 10s)</td>
            </tr>
            <tr>
                <td>Offline Detection</td>
                <td>Banner displayed when offline</td>
            </tr>
            <tr>
                <td>Connectivity Monitoring</td>
                <td><code>connectivity_plus</code> stream</td>
            </tr>
            <tr>
                <td>Graceful Degradation</td>
                <td>Cached data shown when possible</td>
            </tr>
        </table>

        <!-- 14. Localization -->
        <h2>14. Localization</h2>

        <table>
            <tr>
                <th>Language</th>
                <th>Code</th>
                <th>Direction</th>
                <th>Font</th>
            </tr>
            <tr>
                <td>English</td>
                <td><code>en</code></td>
                <td>LTR</td>
                <td>Montserrat</td>
            </tr>
            <tr>
                <td>Arabic</td>
                <td><code>ar</code></td>
                <td>RTL</td>
                <td>Cairo</td>
            </tr>
        </table>

        <p>Full RTL support is implemented with automatic layout direction switching based on selected language.</p>

        <!-- 15. Platform -->
        <h2>15. Platform Support</h2>

        <table>
            <tr>
                <th>Platform</th>
                <th>Status</th>
                <th>Notes</th>
            </tr>
            <tr>
                <td><strong>iOS</strong></td>
                <td class="status-pending">üîß In Development</td>
                <td>Pre-release</td>
            </tr>
            <tr>
                <td><strong>Android</strong></td>
                <td class="status-pending">üîß In Development</td>
                <td>Pre-release</td>
            </tr>
        </table>

        <!-- Footer -->
        <div class="footer">
            <p><strong>DocSera Technology Stack Documentation</strong></p>
            <p>Version 1.0.0+13 ‚Ä¢ Generated: January 15, 2026</p>
            <p>Cross-referenced with Flutter codebase and live Supabase schema</p>
            <p style="margin-top: 10px; color: var(--primary);">¬© 2026 DocSera ‚Ä¢ Patient Application</p>
        </div>

    </div>
</body>

</html>